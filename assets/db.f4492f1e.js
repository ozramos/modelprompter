var Pr=function(e,t){return Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Pr(e,t)};function Ue(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Pr(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function au(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(d){s(d)}}function c(u){try{l(r.throw(u))}catch(d){s(d)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(e,t||[])).next())})}function as(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function vt(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ke(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function ze(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}function dt(e){return this instanceof dt?(this.v=e,this):new dt(e)}function uu(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){r[f]&&(i[f]=function(h){return new Promise(function(p,v){o.push([f,h,p,v])>1||a(f,h)})})}function a(f,h){try{c(r[f](h))}catch(p){d(o[0][3],p)}}function c(f){f.value instanceof dt?Promise.resolve(f.value.v).then(l,u):d(o[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),o.shift(),o.length&&a(o[0][0],o[0][1])}}function cu(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof vt=="function"?vt(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(s){return new Promise(function(a,c){s=e[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function L(e){return typeof e=="function"}function us(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var hr=us(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function jn(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var gt=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=vt(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){t={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}else s.remove(this);var u=this.initialTeardown;if(L(u))try{u()}catch(v){o=v instanceof hr?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=vt(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{eo(p)}catch(v){o=o??[],v instanceof hr?o=ze(ze([],Ke(o)),Ke(v.errors)):o.push(v)}}}catch(v){r={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(o)throw new hr(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)eo(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&jn(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&jn(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),cs=gt.EMPTY;function ls(e){return e instanceof gt||e&&"closed"in e&&L(e.remove)&&L(e.add)&&L(e.unsubscribe)}function eo(e){L(e)?e():e.unsubscribe()}var wi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Dr={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Dr.delegate;return i?.setTimeout?i.setTimeout.apply(i,ze([e,t],Ke(n))):setTimeout.apply(void 0,ze([e,t],Ke(n)))},clearTimeout:function(e){var t=Dr.delegate;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function fs(e){Dr.setTimeout(function(){throw e})}function to(){}var an=null;function xn(e){if(wi.useDeprecatedSynchronousErrorHandling){var t=!an;if(t&&(an={errorThrown:!1,error:null}),e(),t){var n=an,r=n.errorThrown,i=n.error;if(an=null,r)throw i}}else e()}var _i=function(e){Ue(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,ls(n)&&n.add(r)):r.destination=hu,r}return t.create=function(n,r,i){return new Mt(n,r,i)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(gt),lu=Function.prototype.bind;function pr(e,t){return lu.call(e,t)}var fu=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){un(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){un(r)}else un(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){un(n)}},e}(),Mt=function(e){Ue(t,e);function t(n,r,i){var o=e.call(this)||this,s;if(L(n)||!n)s={next:n??void 0,error:r??void 0,complete:i??void 0};else{var a;o&&wi.useDeprecatedNextContext?(a=Object.create(n),a.unsubscribe=function(){return o.unsubscribe()},s={next:n.next&&pr(n.next,a),error:n.error&&pr(n.error,a),complete:n.complete&&pr(n.complete,a)}):s=n}return o.destination=new fu(s),o}return t}(_i);function un(e){fs(e)}function du(e){throw e}var hu={closed:!0,next:to,error:du,complete:to},Si=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Zn(e){return e}function pu(e){return e.length===0?Zn:e.length===1?e[0]:function(n){return e.reduce(function(r,i){return i(r)},n)}}var ee=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var i=this,o=yu(t)?t:new Mt(t,n,r);return xn(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=no(n),new n(function(i,o){var s=new Mt({next:function(a){try{t(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[Si]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return pu(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=no(t),new t(function(r,i){var o;n.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},e.create=function(t){return new e(t)},e}();function no(e){var t;return(t=e??wi.Promise)!==null&&t!==void 0?t:Promise}function vu(e){return e&&L(e.next)&&L(e.error)&&L(e.complete)}function yu(e){return e&&e instanceof _i||vu(e)&&ls(e)}function mu(e){return L(e?.lift)}function Yt(e){return function(t){if(mu(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ut(e,t,n,r,i){return new bu(e,t,n,r,i)}var bu=function(e){Ue(t,e);function t(n,r,i,o,s,a){var c=e.call(this,n)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:e.prototype._next,c._error=o?function(l){try{o(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(_i),gu=us(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Gt=function(e){Ue(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new ro(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new gu},t.prototype.next=function(n){var r=this;xn(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=vt(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},t.prototype.error=function(n){var r=this;xn(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},t.prototype.complete=function(){var n=this;xn(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?cs:(this.currentObservers=null,a.push(n),new gt(function(){r.currentObservers=null,jn(a,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?n.error(o):s&&n.complete()},t.prototype.asObservable=function(){var n=new ee;return n.source=this,n},t.create=function(n,r){return new ro(n,r)},t}(ee),ro=function(e){Ue(t,e);function t(n,r){var i=e.call(this)||this;return i.destination=n,i.source=r,i}return t.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},t.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:cs},t}(Gt),ye=function(e){Ue(t,e);function t(n){var r=e.call(this)||this;return r._value=n,r}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var r=e.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},t.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,o=n._value;if(r)throw i;return this._throwIfClosed(),o},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(Gt),ds={now:function(){return(ds.delegate||Date).now()},delegate:void 0},wu=function(e){Ue(t,e);function t(n,r){return e.call(this)||this}return t.prototype.schedule=function(n,r){return this},t}(gt),Kn={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Kn.delegate;return i?.setInterval?i.setInterval.apply(i,ze([e,t],Ke(n))):setInterval.apply(void 0,ze([e,t],Ke(n)))},clearInterval:function(e){var t=Kn.delegate;return(t?.clearInterval||clearInterval)(e)},delegate:void 0},_u=function(e){Ue(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return t.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Kn.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Kn.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,jn(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(wu),io=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=ds.now,e}(),Su=function(e){Ue(t,e);function t(n,r){r===void 0&&(r=io.now);var i=e.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},t}(io),xu=new Su(_u),ku=xu,Eu=new ee(function(e){return e.complete()});function hs(e){return e&&L(e.schedule)}function xi(e){return e[e.length-1]}function Iu(e){return L(xi(e))?e.pop():void 0}function ki(e){return hs(xi(e))?e.pop():void 0}function Au(e,t){return typeof xi(e)=="number"?e.pop():t}var Ei=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ps(e){return L(e?.then)}function vs(e){return L(e[Si])}function ys(e){return Symbol.asyncIterator&&L(e?.[Symbol.asyncIterator])}function ms(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ou(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var bs=Ou();function gs(e){return L(e?.[bs])}function ws(e){return uu(this,arguments,function(){var n,r,i,o;return as(this,function(s){switch(s.label){case 0:n=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,dt(n.read())];case 3:return r=s.sent(),i=r.value,o=r.done,o?[4,dt(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,dt(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function _s(e){return L(e?.getReader)}function Le(e){if(e instanceof ee)return e;if(e!=null){if(vs(e))return Cu(e);if(Ei(e))return Tu(e);if(ps(e))return Pu(e);if(ys(e))return Ss(e);if(gs(e))return Du(e);if(_s(e))return Ru(e)}throw ms(e)}function Cu(e){return new ee(function(t){var n=e[Si]();if(L(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Tu(e){return new ee(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function Pu(e){return new ee(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,fs)})}function Du(e){return new ee(function(t){var n,r;try{for(var i=vt(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function Ss(e){return new ee(function(t){ju(e,t).catch(function(n){return t.error(n)})})}function Ru(e){return Ss(ws(e))}function ju(e,t){var n,r,i,o;return au(this,void 0,void 0,function(){var s,a;return as(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=cu(e),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Pe(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function xs(e,t){return t===void 0&&(t=0),Yt(function(n,r){n.subscribe(Ut(r,function(i){return Pe(r,e,function(){return r.next(i)},t)},function(){return Pe(r,e,function(){return r.complete()},t)},function(i){return Pe(r,e,function(){return r.error(i)},t)}))})}function ks(e,t){return t===void 0&&(t=0),Yt(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Ku(e,t){return Le(e).pipe(ks(t),xs(t))}function Bu(e,t){return Le(e).pipe(ks(t),xs(t))}function Mu(e,t){return new ee(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function Uu(e,t){return new ee(function(n){var r;return Pe(n,t,function(){r=e[bs](),Pe(n,t,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){n.error(a);return}s?n.complete():n.next(o)},0,!0)}),function(){return L(r?.return)&&r.return()}})}function Es(e,t){if(!e)throw new Error("Iterable cannot be null");return new ee(function(n){Pe(n,t,function(){var r=e[Symbol.asyncIterator]();Pe(n,t,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Lu(e,t){return Es(ws(e),t)}function Fu(e,t){if(e!=null){if(vs(e))return Ku(e,t);if(Ei(e))return Mu(e,t);if(ps(e))return Bu(e,t);if(ys(e))return Es(e,t);if(gs(e))return Uu(e,t);if(_s(e))return Lu(e,t)}throw ms(e)}function ke(e,t){return t?Fu(e,t):Le(e)}function De(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ki(e);return ke(e,n)}function $u(e,t){var n=L(e)?e:function(){return e},r=function(i){return i.error(n())};return new ee(t?function(i){return t.schedule(r,0,i)}:r)}function Nu(e){return e instanceof Date&&!isNaN(e)}function er(e,t){return Yt(function(n,r){var i=0;n.subscribe(Ut(r,function(o){r.next(e.call(t,o,i++))}))})}var Wu=Array.isArray;function Hu(e,t){return Wu(t)?e.apply(void 0,ze([],Ke(t))):e(t)}function Is(e){return er(function(t){return Hu(e,t)})}var Vu=Array.isArray,zu=Object.getPrototypeOf,qu=Object.prototype,Yu=Object.keys;function Gu(e){if(e.length===1){var t=e[0];if(Vu(t))return{args:t,keys:null};if(Ju(t)){var n=Yu(t);return{args:n.map(function(r){return t[r]}),keys:n}}}return{args:e,keys:null}}function Ju(e){return e&&typeof e=="object"&&zu(e)===qu}function Xu(e,t){return e.reduce(function(n,r,i){return n[r]=t[i],n},{})}function Bn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ki(e),r=Iu(e),i=Gu(e),o=i.args,s=i.keys;if(o.length===0)return ke([],n);var a=new ee(Qu(o,n,s?function(c){return Xu(s,c)}:Zn));return r?a.pipe(Is(r)):a}function Qu(e,t,n){return n===void 0&&(n=Zn),function(r){oo(t,function(){for(var i=e.length,o=new Array(i),s=i,a=i,c=function(u){oo(t,function(){var d=ke(e[u],t),f=!1;d.subscribe(Ut(r,function(h){o[u]=h,f||(f=!0,a--),a||r.next(n(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function oo(e,t,n){e?Pe(n,e,t):t()}function Zu(e,t,n,r,i,o,s,a){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&t.complete()},h=function(v){return l<r?p(v):c.push(v)},p=function(v){o&&t.next(v),l++;var m=!1;Le(n(v,u++)).subscribe(Ut(t,function(b){i?.(b),o?h(b):t.next(b)},function(){m=!0},void 0,function(){if(m)try{l--;for(var b=function(){var w=c.shift();s?Pe(t,s,function(){return p(w)}):p(w)};c.length&&l<r;)b();f()}catch(w){t.error(w)}}))};return e.subscribe(Ut(t,h,function(){d=!0,f()})),function(){a?.()}}function Ii(e,t,n){return n===void 0&&(n=1/0),L(t)?Ii(function(r,i){return er(function(o,s){return t(r,o,i,s)})(Le(e(r,i)))},n):(typeof t=="number"&&(n=t),Yt(function(r,i){return Zu(r,i,e,n)}))}function ec(e){return e===void 0&&(e=1/0),Ii(Zn,e)}var tc=["addListener","removeListener"],nc=["addEventListener","removeEventListener"],rc=["on","off"];function Se(e,t,n,r){if(L(n)&&(r=n,n=void 0),r)return Se(e,t,n).pipe(Is(r));var i=Ke(sc(e)?nc.map(function(a){return function(c){return e[a](t,c,n)}}):ic(e)?tc.map(so(e,t)):oc(e)?rc.map(so(e,t)):[],2),o=i[0],s=i[1];if(!o&&Ei(e))return Ii(function(a){return Se(a,t,n)})(Le(e));if(!o)throw new TypeError("Invalid event target");return new ee(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function so(e,t){return function(n){return function(r){return e[n](t,r)}}}function ic(e){return L(e.addListener)&&L(e.removeListener)}function oc(e){return L(e.on)&&L(e.off)}function sc(e){return L(e.addEventListener)&&L(e.removeEventListener)}function ac(e,t,n){e===void 0&&(e=0),n===void 0&&(n=ku);var r=-1;return t!=null&&(hs(t)?n=t:r=t),new ee(function(i){var o=Nu(e)?+e-n.now():e;o<0&&(o=0);var s=0;return n.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function As(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ki(e),r=Au(e,1/0),i=e;return i.length?i.length===1?Le(i[0]):ec(r)(ke(i,n)):Eu}function uc(e){e===void 0&&(e={});var t=e.connector,n=t===void 0?function(){return new Gt}:t,r=e.resetOnError,i=r===void 0?!0:r,o=e.resetOnComplete,s=o===void 0?!0:o,a=e.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,d,f,h=0,p=!1,v=!1,m=function(){d?.unsubscribe(),d=void 0},b=function(){m(),u=f=void 0,p=v=!1},w=function(){var y=u;b(),y?.unsubscribe()};return Yt(function(y,g){h++,!v&&!p&&m();var _=f=f??n();g.add(function(){h--,h===0&&!v&&!p&&(d=vr(w,c))}),_.subscribe(g),!u&&h>0&&(u=new Mt({next:function(S){return _.next(S)},error:function(S){v=!0,m(),d=vr(b,i,S),_.error(S)},complete:function(){p=!0,m(),d=vr(b,s),_.complete()}}),Le(y).subscribe(u))})(l)}}function vr(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(t===!0){e();return}if(t!==!1){var i=new Mt({next:function(){i.unsubscribe(),e()}});return Le(t.apply(void 0,ze([],Ke(n)))).subscribe(i)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Rr=function(e,t){return Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Rr(e,t)};function cc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Rr(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var M=function(){return M=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},M.apply(this,arguments)};function jr(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var $=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,J=Object.keys,oe=Array.isArray;typeof Promise<"u"&&!$.Promise&&($.Promise=Promise);function ae(e,t){return typeof t!="object"||J(t).forEach(function(n){e[n]=t[n]}),e}var yt=Object.getPrototypeOf,lc={}.hasOwnProperty;function pe(e,t){return lc.call(e,t)}function mt(e,t){typeof t=="function"&&(t=t(yt(e))),(typeof Reflect>"u"?J:Reflect.ownKeys)(t).forEach(function(n){Be(e,n,t[n])})}var Os=Object.defineProperty;function Be(e,t,n,r){Os(e,t,ae(n&&pe(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function wt(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Be(e.prototype,"constructor",e),{extend:mt.bind(null,e.prototype)}}}}var fc=Object.getOwnPropertyDescriptor;function Ai(e,t){var n=fc(e,t),r;return n||(r=yt(e))&&Ai(r,t)}var dc=[].slice;function tr(e,t,n){return dc.call(e,t,n)}function Cs(e,t){return t(e)}function Ct(e){if(!e)throw new Error("Assertion Failed")}function Ts(e){$.setImmediate?setImmediate(e):setTimeout(e,0)}function Ps(e,t){return e.reduce(function(n,r,i){var o=t(r,i);return o&&(n[o[0]]=o[1]),n},{})}function hc(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}function Re(e,t){if(pe(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var o=Re(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(s!==-1){var a=e[t.substr(0,s)];return a===void 0?void 0:Re(a,t.substr(s+1))}}function he(e,t,n){if(!(!e||t===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Ct(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)he(e,t[r],n[r])}else{var o=t.indexOf(".");if(o!==-1){var s=t.substr(0,o),a=t.substr(o+1);if(a==="")n===void 0?oe(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var c=e[s];(!c||!pe(e,s))&&(c=e[s]={}),he(c,a,n)}}else n===void 0?oe(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function pc(e,t){typeof t=="string"?he(e,t,void 0):"length"in t&&[].map.call(t,function(n){he(e,n,void 0)})}function Ds(e){var t={};for(var n in e)pe(e,n)&&(t[n]=e[n]);return t}var vc=[].concat;function Rs(e){return vc.apply([],e)}var js="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Rs([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return $[e]}),yc=js.map(function(e){return $[e]});Ps(js,function(e){return[e,!0]});var $e=null;function Jt(e){$e=typeof WeakMap<"u"&&new WeakMap;var t=Kr(e);return $e=null,t}function Kr(e){if(!e||typeof e!="object")return e;var t=$e&&$e.get(e);if(t)return t;if(oe(e)){t=[],$e&&$e.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Kr(e[n]))}else if(yc.indexOf(e.constructor)>=0)t=e;else{var i=yt(e);t=i===Object.prototype?{}:Object.create(i),$e&&$e.set(e,t);for(var o in e)pe(e,o)&&(t[o]=Kr(e[o]))}return t}var mc={}.toString;function Br(e){return mc.call(e).slice(8,-1)}var Mr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",bc=typeof Mr=="symbol"?function(e){var t;return e!=null&&(t=e[Mr])&&t.apply(e)}:function(){return null},lt={};function Ce(e){var t,n,r,i;if(arguments.length===1){if(oe(e))return e.slice();if(this===lt&&typeof e=="string")return[e];if(i=bc(e)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(e==null)return[e];if(t=e.length,typeof t=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var Oi=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ee=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ks(e,t){Ee=e,Bs=t}var Bs=function(){return!0},gc=!new Error("").stack;function ot(){if(gc)try{throw ot.arguments,new Error}catch(e){return e}return new Error}function Ur(e,t){var n=e.stack;return n?(t=t||0,n.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),n.split(`
`).slice(t).filter(Bs).map(function(r){return`
`+r}).join("")):""}var wc=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Ms=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ci=wc.concat(Ms),_c={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function _t(e,t){this._e=ot(),this.name=e,this.message=t}wt(_t).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ur(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Us(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function Mn(e,t,n,r){this._e=ot(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Us(e,t)}wt(Mn).from(_t);function ft(e,t){this._e=ot(),this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Us(e,this.failures)}wt(ft).from(_t);var Ti=Ci.reduce(function(e,t){return e[t]=t+"Error",e},{}),Sc=_t,K=Ci.reduce(function(e,t){var n=t+"Error";function r(i,o){this._e=ot(),this.name=n,i?typeof i=="string"?(this.message="".concat(i).concat(o?`
 `+o:""),this.inner=o||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=_c[t]||n,this.inner=null)}return wt(r).from(Sc),e[t]=r,e},{});K.Syntax=SyntaxError;K.Type=TypeError;K.Range=RangeError;var ao=Ms.reduce(function(e,t){return e[t+"Error"]=K[t],e},{});function xc(e,t){if(!e||e instanceof _t||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ao[e.name])return e;var n=new ao[e.name](t||e.message,e);return"stack"in e&&Be(n,"stack",{get:function(){return this.inner.stack}}),n}var nr=Ci.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=K[t]),e},{});nr.ModifyError=Mn;nr.DexieError=_t;nr.BulkError=ft;function F(){}function Xt(e){return e}function kc(e,t){return e==null||e===Xt?t:function(n){return t(e(n))}}function rt(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ec(e,t){return e===F?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?rt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?rt(i,this.onerror):i),o!==void 0?o:n}}function Ic(e,t){return e===F?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?rt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?rt(r,this.onerror):r)}}function Ac(e,t){return e===F?t:function(n){var r=e.apply(this,arguments);ae(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?rt(i,this.onsuccess):i),o&&(this.onerror=this.onerror?rt(o,this.onerror):o),r===void 0?s===void 0?void 0:s:ae(r,s)}}function Oc(e,t){return e===F?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function Pi(e,t){return e===F?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}var Lt={},Cc=100,Tc=20,Ls=100,Di=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,yt(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,yt(t),e]}(),Lr=Di[0],Un=Di[1],Fr=Di[2],Fs=Un&&Un.then,kn=Lr&&Lr.constructor,Ri=!!Fr,$r=!1,Pc=Fr?function(){Fr.then(cn)}:$.setImmediate?setImmediate.bind(null,cn):$.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){cn(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(cn,0)},Ft=function(e,t){Tt.push([e,t]),Ln&&(Pc(),Ln=!1)},Nr=!0,Ln=!0,et=[],En=[],Wr=null,Hr=Xt,ht={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:lo,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{lo(e[0],e[1])}catch{}})}},j=ht,Tt=[],tt=0,In=[];function C(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=F,this._lib=!1;var t=this._PSD=j;if(Ee&&(this._stackHolder=ot(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==Lt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&zr(this,this._value);return}this._state=null,this._value=null,++t.ref,Ns(this,e)}var Vr={get:function(){var e=j,t=Fn;function n(r,i){var o=this,s=!e.global&&(e!==j||t!==Fn),a=s&&!Me(),c=new C(function(l,u){ji(o,new $s(Nn(r,e,s,a),Nn(i,e,s,a),l,u,e))});return Ee&&Vs(c,this),c}return n.prototype=Lt,n},set:function(e){Be(this,"then",e&&e.prototype===Lt?Vr:{get:function(){return e},set:Vr.set})}};mt(C.prototype,{then:Vr,_then:function(e,t){ji(this,new $s(null,null,e,t,j))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,function(r){return r instanceof t?n(r):An(r)}):this.then(null,function(r){return r&&r.name===t?n(r):An(r)})},finally:function(e){return this.then(function(t){return e(),t},function(t){return e(),An(t)})},stack:{get:function(){if(this._stack)return this._stack;try{$r=!0;var e=Hs(this,[],Tc),t=e.join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{$r=!1}}},timeout:function(e,t){var n=this;return e<1/0?new C(function(r,i){var o=setTimeout(function(){return i(new K.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&Be(C.prototype,Symbol.toStringTag,"Dexie.Promise");ht.env=zs();function $s(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}mt(C,{all:function(){var e=Ce.apply(null,arguments).map($n);return new C(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,o){return C.resolve(i).then(function(s){e[o]=s,--r||t(e)},n)})})},resolve:function(e){if(e instanceof C)return e;if(e&&typeof e.then=="function")return new C(function(n,r){e.then(n,r)});var t=new C(Lt,!0,e);return Vs(t,Wr),t},reject:An,race:function(){var e=Ce.apply(null,arguments).map($n);return new C(function(t,n){e.map(function(r){return C.resolve(r).then(t,n)})})},PSD:{get:function(){return j},set:function(e){return j=e}},totalEchoes:{get:function(){return Fn}},newPSD:qe,usePSD:xt,scheduler:{get:function(){return Ft},set:function(e){Ft=e}},rejectionMapper:{get:function(){return Hr},set:function(e){Hr=e}},follow:function(e,t){return new C(function(n,r){return qe(function(i,o){var s=j;s.unhandleds=[],s.onunhandled=o,s.finalize=rt(function(){var a=this;Rc(function(){a.unhandleds.length===0?i():o(a.unhandleds[0])})},s.finalize),e()},t,n,r)})}});kn&&(kn.allSettled&&Be(C,"allSettled",function(){var e=Ce.apply(null,arguments).map($n);return new C(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,o){return C.resolve(i).then(function(s){return r[o]={status:"fulfilled",value:s}},function(s){return r[o]={status:"rejected",reason:s}}).then(function(){return--n||t(r)})})})}),kn.any&&typeof AggregateError<"u"&&Be(C,"any",function(){var e=Ce.apply(null,arguments).map($n);return new C(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(o,s){return C.resolve(o).then(function(a){return t(a)},function(a){i[s]=a,--r||n(new AggregateError(i))})})})}));function Ns(e,t){try{t(function(n){if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Qt();n&&typeof n.then=="function"?Ns(e,function(i,o){n instanceof C?n._then(i,o):n.then(i,o)}):(e._state=!0,e._value=n,Ws(e)),r&&Zt()}},zr.bind(null,e))}catch(n){zr(e,n)}}function zr(e,t){if(En.push(t),e._state===null){var n=e._lib&&Qt();t=Hr(t),e._state=!1,e._value=t,Ee&&t!==null&&typeof t=="object"&&!t._promise&&hc(function(){var r=Ai(t,"stack");t._promise=e,Be(t,"stack",{get:function(){return $r?r&&(r.get?r.get.apply(t):r.value):e.stack}})}),jc(e),Ws(e),n&&Zt()}}function Ws(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)ji(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),tt===0&&(++tt,Ft(function(){--tt===0&&Ki()},[]))}function ji(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++tt,Ft(Dc,[n,e,t])}function Dc(e,t,n){try{Wr=t;var r,i=t._value;t._state?r=e(i):(En.length&&(En=[]),r=e(i),En.indexOf(i)===-1&&Kc(t)),n.resolve(r)}catch(o){n.reject(o)}finally{Wr=null,--tt===0&&Ki(),--n.psd.ref||n.psd.finalize()}}function Hs(e,t,n){if(t.length===n)return t;var r="";if(e._state===!1){var i=e._value,o,s;i!=null?(o=i.name||"Error",s=i.message||i,r=Ur(i,0)):(o=i,s=""),t.push(o+(s?": "+s:"")+r)}return Ee&&(r=Ur(e._stackHolder,2),r&&t.indexOf(r)===-1&&t.push(r),e._prev&&Hs(e._prev,t,n)),t}function Vs(e,t){var n=t?t._numPrev+1:0;n<Cc&&(e._prev=t,e._numPrev=n)}function cn(){Qt()&&Zt()}function Qt(){var e=Nr;return Nr=!1,Ln=!1,e}function Zt(){var e,t,n;do for(;Tt.length>0;)for(e=Tt,Tt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Tt.length>0);Nr=!0,Ln=!0}function Ki(){var e=et;et=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=In.slice(0),n=t.length;n;)t[--n]()}function Rc(e){function t(){e(),In.splice(In.indexOf(t),1)}In.push(t),++tt,Ft(function(){--tt===0&&Ki()},[])}function jc(e){et.some(function(t){return t._value===e._value})||et.push(e)}function Kc(e){for(var t=et.length;t;)if(et[--t]._value===e._value){et.splice(t,1);return}}function An(e){return new C(Lt,!1,e)}function W(e,t){var n=j;return function(){var r=Qt(),i=j;try{return Ye(n,!0),e.apply(this,arguments)}catch(o){t&&t(o)}finally{Ye(i,!1),r&&Zt()}}}var ie={awaits:0,echoes:0,id:0},Bc=0,On=[],yr=0,Fn=0,Mc=0;function qe(e,t,n,r){var i=j,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Mc;var s=ht.env;o.env=Ri?{Promise:C,PromiseProp:{value:C,configurable:!0,writable:!0},all:C.all,race:C.race,allSettled:C.allSettled,any:C.any,resolve:C.resolve,reject:C.reject,nthen:uo(s.nthen,o),gthen:uo(s.gthen,o)}:{},t&&ae(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=xt(o,e,n,r);return o.ref===0&&o.finalize(),a}function St(){return ie.id||(ie.id=++Bc),++ie.awaits,ie.echoes+=Ls,ie.id}function Me(){return ie.awaits?(--ie.awaits===0&&(ie.id=0),ie.echoes=ie.awaits*Ls,!0):!1}(""+Fs).indexOf("[native code]")===-1&&(St=Me=F);function $n(e){return ie.echoes&&e&&e.constructor===kn?(St(),e.then(function(t){return Me(),t},function(t){return Me(),Z(t)})):e}function Uc(e){++Fn,(!ie.echoes||--ie.echoes===0)&&(ie.echoes=ie.id=0),On.push(j),Ye(e,!0)}function Lc(){var e=On[On.length-1];On.pop(),Ye(e,!1)}function Ye(e,t){var n=j;if((t?ie.echoes&&(!yr++||e!==j):yr&&(!--yr||e!==j))&&qs(t?Uc.bind(null,e):Lc),e!==j&&(j=e,n===ht&&(ht.env=zs()),Ri)){var r=ht.env.Promise,i=e.env;Un.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty($,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function zs(){var e=$.Promise;return Ri?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor($,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Un.then,gthen:e.prototype.then}:{}}function xt(e,t,n,r,i){var o=j;try{return Ye(e,!0),t(n,r,i)}finally{Ye(o,!1)}}function qs(e){Fs.call(Lr,e)}function Nn(e,t,n,r){return typeof e!="function"?e:function(){var i=j;n&&St(),Ye(t,!0);try{return e.apply(this,arguments)}finally{Ye(i,!1),r&&qs(Me)}}}function uo(e,t){return function(n,r){return e.call(this,Nn(n,t),Nn(r,t))}}var co="unhandledrejection";function lo(e,t){var n;try{n=t.onuncatched(e)}catch{}if(n!==!1)try{var r,i={promise:t,reason:e};if($.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(co,!0,!0),ae(r,i)):$.CustomEvent&&(r=new CustomEvent(co,{detail:i}),ae(r,i)),r&&$.dispatchEvent&&(dispatchEvent(r),!$.PromiseRejectionEvent&&$.onunhandledrejection))try{$.onunhandledrejection(r)}catch{}Ee&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: ".concat(e.stack||e))}catch{}}var Z=C.reject;function qr(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!j.letThrough&&!e._vip){if(e._state.openComplete)return Z(new K.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Z(new K.DatabaseClosed);e.open().catch(F)}return e._state.dbReadyPromise.then(function(){return qr(e,t,n,r)})}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===Ti.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return qr(e,t,n,r)})):Z(o)}return i._promise(t,function(o,s){return qe(function(){return j.trans=i,r(o,s,i)})}).then(function(o){return i._completion.then(function(){return o})})}}var fo="4.0.1-alpha.10",Ze=String.fromCharCode(65535),Yr=-1/0,Ie="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ys="String expected.",Pt=[],rr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Fc=rr,$c=rr,Gs=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},ir="__dbnames",mr="readonly",br="readwrite";function it(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Js={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ln(e){return typeof e=="string"&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=Jt(t),delete t[e]),t}:function(t){return t}}function Nc(){throw K.Type()}function Y(e,t){try{var n=ho(e),r=ho(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return Hc(po(e),po(t));case"Array":return Wc(e,t)}}catch{}return NaN}function Wc(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o){var s=Y(e[o],t[o]);if(s!==0)return s}return n===r?0:n<r?-1:1}function Hc(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,o=0;o<i;++o)if(e[o]!==t[o])return e[o]<t[o]?-1:1;return n===r?0:n<r?-1:1}function ho(e){var t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";var n=Br(e);return n==="ArrayBuffer"?"binary":n}function po(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Vc=function(){function e(){}return e.prototype._trans=function(t,n,r){var i=this._tx||j.trans,o=this.name;function s(c,l,u){if(!u.schema[o])throw new K.NotFound("Table "+o+" not part of transaction");return n(u.idbtrans,u)}var a=Qt();try{return i&&i.db===this.db?i===j.trans?i._promise(t,s,r):qe(function(){return i._promise(t,s,r)},{trans:i,transless:j.transless||j}):qr(this.db,t,[this.name],s)}finally{a&&Zt()}},e.prototype.get=function(t,n){var r=this;return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:t}).then(function(o){return r.hook.reading.fire(o)})}).then(n)},e.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(oe(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var n=J(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(u){return u.compound&&n.every(function(d){return u.keyPath.indexOf(d)>=0})&&u.keyPath.every(function(d){return n.indexOf(d)>=0})})[0];if(r&&this.db._maxKey!==Ze)return this.where(r.name).equals(r.keyPath.map(function(u){return t[u]}));!r&&Ee&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit of a ")+"compound index [".concat(n.join("+"),"]"));var i=this.schema.idxByName,o=this.db._deps.indexedDB;function s(u,d){return o.cmp(u,d)===0}var a=n.reduce(function(u,d){var f=u[0],h=u[1],p=i[d],v=t[d];return[f||p,f||!p?it(h,p&&p.multi?function(m){var b=Re(m,d);return oe(b)&&b.some(function(w){return s(v,w)})}:function(m){return s(v,Re(m,d))}):h]},[null,null]),c=a[0],l=a[1];return c?this.where(c.name).equals(t[c.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")},e.prototype.filter=function(t){return this.toCollection().and(t)},e.prototype.count=function(t){return this.toCollection().count(t)},e.prototype.offset=function(t){return this.toCollection().offset(t)},e.prototype.limit=function(t){return this.toCollection().limit(t)},e.prototype.each=function(t){return this.toCollection().each(t)},e.prototype.toArray=function(t){return this.toCollection().toArray(t)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,oe(t)?"[".concat(t.join("+"),"]"):t))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(t){var n=this,r=n.db,i=n.name;this.schema.mappedClass=t,t.prototype instanceof Nc&&(t=function(c){cc(l,c);function l(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(l.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),l.prototype.table=function(){return i},l}(t));for(var o=new Set,s=t.prototype;s;s=yt(s))Object.getOwnPropertyNames(s).forEach(function(c){return o.add(c)});var a=function(c){if(!c)return c;var l=Object.create(t.prototype);for(var u in c)if(!o.has(u))try{l[u]=c[u]}catch{}return l};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),t},e.prototype.defineClass=function(){function t(n){ae(this,n)}return this.mapToClass(t)},e.prototype.add=function(t,n){var r=this,i=this.schema.primKey,o=i.auto,s=i.keyPath,a=t;return s&&o&&(a=ln(s)(t)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"add",keys:n!=null?[n]:null,values:[a]})}).then(function(c){return c.numFailures?C.reject(c.failures[0]):c.lastResult}).then(function(c){if(s)try{he(t,s,c)}catch{}return c})},e.prototype.update=function(t,n){if(typeof t=="object"&&!oe(t)){var r=Re(t,this.schema.primKey.keyPath);if(r===void 0)return Z(new K.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?J(n).forEach(function(i){he(t,i,n[i])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(t).modify(n)},e.prototype.put=function(t,n){var r=this,i=this.schema.primKey,o=i.auto,s=i.keyPath,a=t;return s&&o&&(a=ln(s)(t)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"put",values:[a],keys:n!=null?[n]:null})}).then(function(c){return c.numFailures?C.reject(c.failures[0]):c.lastResult}).then(function(c){if(s)try{he(t,s,c)}catch{}return c})},e.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[t]})}).then(function(r){return r.numFailures?C.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"deleteRange",range:Js})}).then(function(n){return n.numFailures?C.reject(n.failures[0]):void 0})},e.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:t,trans:r}).then(function(i){return i.map(function(o){return n.hook.reading.fire(o)})})})},e.prototype.bulkAdd=function(t,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var s=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var c=i.schema.primKey,l=c.auto,u=c.keyPath;if(u&&o)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var d=t.length,f=u&&l?t.map(ln(u)):t;return i.core.mutate({trans:a,type:"add",keys:o,values:f,wantResults:s}).then(function(h){var p=h.numFailures,v=h.results,m=h.lastResult,b=h.failures,w=s?v:m;if(p===0)return w;throw new ft("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(d," operations failed"),b)})})},e.prototype.bulkPut=function(t,n,r){var i=this,o=Array.isArray(n)?n:void 0;r=r||(o?void 0:n);var s=r?r.allKeys:void 0;return this._trans("readwrite",function(a){var c=i.schema.primKey,l=c.auto,u=c.keyPath;if(u&&o)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==t.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var d=t.length,f=u&&l?t.map(ln(u)):t;return i.core.mutate({trans:a,type:"put",keys:o,values:f,wantResults:s}).then(function(h){var p=h.numFailures,v=h.results,m=h.lastResult,b=h.failures,w=s?v:m;if(p===0)return w;throw new ft("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(d," operations failed"),b)})})},e.prototype.bulkUpdate=function(t){var n=this,r=this.core,i=t.map(function(a){return a.key}),o=t.map(function(a){return a.changes}),s=[];return this._trans("readwrite",function(a){return r.getMany({trans:a,keys:i,cache:"clone"}).then(function(c){var l=[],u=[];t.forEach(function(f,h){var p=f.key,v=f.changes,m=c[h];if(m){for(var b=0,w=Object.keys(v);b<w.length;b++){var y=w[b],g=v[y];if(y===n.schema.primKey.keyPath){if(Y(g,p)!==0)throw new K.Constraint("Cannot update primary key in bulkUpdate()")}else he(m,y,g)}s.push(h),l.push(p),u.push(m)}});var d=l.length;return r.mutate({trans:a,type:"put",keys:l,values:u,updates:{keys:i,changeSpecs:o}}).then(function(f){var h=f.numFailures,p=f.failures;if(h===0)return d;for(var v=0,m=Object.keys(p);v<m.length;v++){var b=m[v],w=s[Number(b)];if(w!=null){var y=p[b];delete p[b],p[w]=y}}throw new ft("".concat(n.name,".bulkUpdate(): ").concat(h," of ").concat(d," operations failed"),p)})})})},e.prototype.bulkDelete=function(t){var n=this,r=t.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:t})}).then(function(i){var o=i.numFailures,s=i.lastResult,a=i.failures;if(o===0)return s;throw new ft("".concat(n.name,".bulkDelete(): ").concat(o," of ").concat(r," operations failed"),a)})},e}();function en(e){var t={},n=function(a,c){if(c){for(var l=arguments.length,u=new Array(l-1);--l;)u[l-1]=arguments[l];return t[a].subscribe.apply(null,u),e}else if(typeof a=="string")return t[a]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(a,c,l){if(typeof a=="object")return s(a);c||(c=Oc),l||(l=F);var u={subscribers:[],fire:l,subscribe:function(d){u.subscribers.indexOf(d)===-1&&(u.subscribers.push(d),u.fire=c(u.fire,d))},unsubscribe:function(d){u.subscribers=u.subscribers.filter(function(f){return f!==d}),u.fire=u.subscribers.reduce(c,l)}};return t[a]=n[a]=u,u}function s(a){J(a).forEach(function(c){var l=a[c];if(oe(l))o(c,a[c][0],a[c][1]);else if(l==="asap")var u=o(c,Xt,function(){for(var f=arguments.length,h=new Array(f);f--;)h[f]=arguments[f];u.subscribers.forEach(function(p){Ts(function(){p.apply(null,h)})})});else throw new K.InvalidArgument("Invalid event config")})}}function tn(e,t){return wt(t).from({prototype:e}),t}function zc(e){return tn(Vc.prototype,function(n,r,i){this.db=e,this._tx=i,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:en(null,{creating:[Ec,F],reading:[kc,Xt],updating:[Ac,F],deleting:[Ic,F]})})}function st(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function gr(e,t){e.filter=it(e.filter,t)}function wr(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return it(r(),t())}:t,e.justLimit=n&&!r}function qc(e,t){e.isMatch=it(e.isMatch,t)}function Cn(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new K.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function vo(e,t,n){var r=Cn(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function fn(e,t,n,r){var i=e.replayFilter?it(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(a,c,l){if(!i||i(c,l,function(f){return c.stop(f)},function(f){return c.fail(f)})){var u=c.primaryKey,d=""+u;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(u)),pe(o,d)||(o[d]=!0,t(a,c,l))}};return Promise.all([e.or._iterate(s,n),yo(vo(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}else return yo(vo(e,r,n),it(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function yo(e,t,n,r){var i=r?function(s,a,c){return n(r(s),a,c)}:n,o=W(i);return e.then(function(s){if(s)return s.start(function(){var a=function(){return s.continue()};(!t||t(s,function(c){return a=c},function(c){s.stop(c),a=F},function(c){s.fail(c),a=F}))&&o(s.value,s,function(c){return a=c}),a()})})}var Yc=function(){function e(){}return e.prototype._read=function(t,n){var r=this._ctx;return r.error?r.table._trans(null,Z.bind(null,r.error)):r.table._trans("readonly",t).then(n)},e.prototype._write=function(t){var n=this._ctx;return n.error?n.table._trans(null,Z.bind(null,n.error)):n.table._trans("readwrite",t,"locked")},e.prototype._addAlgorithm=function(t){var n=this._ctx;n.algorithm=it(n.algorithm,t)},e.prototype._iterate=function(t,n){return fn(this._ctx,t,n,this._ctx.table.core)},e.prototype.clone=function(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&ae(r,t),n._ctx=r,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(t){var n=this._ctx;return this._read(function(r){return fn(n,t,r,n.table.core)})},e.prototype.count=function(t){var n=this;return this._read(function(r){var i=n._ctx,o=i.table.core;if(st(i,!0))return o.count({trans:r,query:{index:Cn(i,o.schema),range:i.range}}).then(function(a){return Math.min(a,i.limit)});var s=0;return fn(i,function(){return++s,!1},r,o).then(function(){return s})}).then(t)},e.prototype.sortBy=function(t,n){var r=t.split(".").reverse(),i=r[0],o=r.length-1;function s(l,u){return u?s(l[r[u]],u-1):l[i]}var a=this._ctx.dir==="next"?1:-1;function c(l,u){var d=s(l,o),f=s(u,o);return d<f?-a:d>f?a:0}return this.toArray(function(l){return l.sort(c)}).then(n)},e.prototype.toArray=function(t){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&st(i,!0)&&i.limit>0){var o=i.valueMapper,s=Cn(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:s,range:i.range}}).then(function(c){var l=c.result;return o?l.map(o):l})}else{var a=[];return fn(i,function(c){return a.push(c)},r,i.table.core).then(function(){return a})}},t)},e.prototype.offset=function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,st(n)?wr(n,function(){var r=t;return function(i,o){return r===0?!0:r===1?(--r,!1):(o(function(){i.advance(r),r=0}),!1)}}):wr(n,function(){var r=t;return function(){return--r<0}}),this)},e.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),wr(this._ctx,function(){var n=t;return function(r,i,o){return--n<=0&&i(o),n>=0}},!0),this},e.prototype.until=function(t,n){return gr(this._ctx,function(r,i,o){return t(r.value)?(i(o),n):!0}),this},e.prototype.first=function(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)},e.prototype.last=function(t){return this.reverse().first(t)},e.prototype.filter=function(t){return gr(this._ctx,function(n){return t(n.value)}),qc(this._ctx,t),this},e.prototype.and=function(t){return this.filter(t)},e.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})},e.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},e.prototype.eachPrimaryKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})},e.prototype.keys=function(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.key)}).then(function(){return r}).then(t)},e.prototype.primaryKeys=function(t){var n=this._ctx;if(n.dir==="next"&&st(n,!0)&&n.limit>0)return this._read(function(i){var o=Cn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:o,range:n.range}})}).then(function(i){var o=i.result;return o}).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,o){r.push(o.primaryKey)}).then(function(){return r}).then(t)},e.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},e.prototype.firstKey=function(t){return this.limit(1).keys(function(n){return n[0]}).then(t)},e.prototype.lastKey=function(t){return this.reverse().firstKey(t)},e.prototype.distinct=function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return gr(this._ctx,function(i){var o=i.primaryKey.toString(),s=pe(r,o);return r[o]=!0,!s}),this},e.prototype.modify=function(t){var n=this,r=this._ctx;return this._write(function(i){var o;if(typeof t=="function")o=t;else{var s=J(t),a=s.length;o=function(b){for(var w=!1,y=0;y<a;++y){var g=s[y],_=t[g];Re(b,g)!==_&&(he(b,g,_),w=!0)}return w}}var c=r.table.core,l=c.schema.primaryKey,u=l.outbound,d=l.extractKey,f=n.db._options.modifyChunkSize||200,h=[],p=0,v=[],m=function(b,w){var y=w.failures,g=w.numFailures;p+=b-g;for(var _=0,S=J(y);_<S.length;_++){var k=S[_];h.push(y[k])}};return n.clone().primaryKeys().then(function(b){var w=function(y){var g=Math.min(f,b.length-y);return c.getMany({trans:i,keys:b.slice(y,y+g),cache:"immutable"}).then(function(_){for(var S=[],k=[],x=u?[]:null,I=[],E=0;E<g;++E){var A=_[E],T={value:Jt(A),primKey:b[y+E]};o.call(T,T.value,T)!==!1&&(T.value==null?I.push(b[y+E]):!u&&Y(d(A),d(T.value))!==0?(I.push(b[y+E]),S.push(T.value)):(k.push(T.value),u&&x.push(b[y+E])))}var O=st(r)&&r.limit===1/0&&(typeof t!="function"||t===_r)&&{index:r.index,range:r.range};return Promise.resolve(S.length>0&&c.mutate({trans:i,type:"add",values:S}).then(function(P){for(var D in P.failures)I.splice(parseInt(D),1);m(S.length,P)})).then(function(){return(k.length>0||O&&typeof t=="object")&&c.mutate({trans:i,type:"put",keys:x,values:k,criteria:O,changeSpec:typeof t!="function"&&t}).then(function(P){return m(k.length,P)})}).then(function(){return(I.length>0||O&&t===_r)&&c.mutate({trans:i,type:"delete",keys:I,criteria:O}).then(function(P){return m(I.length,P)})}).then(function(){return b.length>y+g&&w(y+f)})})};return w(0).then(function(){if(h.length>0)throw new Mn("Error modifying one or more objects",h,p,v);return b.length})})})},e.prototype.delete=function(){var t=this._ctx,n=t.range;return st(t)&&(t.isPrimKey&&!$c||n.type===3)?this._write(function(r){var i=t.table.core.schema.primaryKey,o=n;return t.table.core.count({trans:r,query:{index:i,range:o}}).then(function(s){return t.table.core.mutate({trans:r,type:"deleteRange",range:o}).then(function(a){var c=a.failures;a.lastResult,a.results;var l=a.numFailures;if(l)throw new Mn("Could not delete some values",Object.keys(c).map(function(u){return c[u]}),s-l);return s-l})})}):this.modify(_r)},e}(),_r=function(e,t){return t.value=null};function Gc(e){return tn(Yc.prototype,function(n,r){this.db=e;var i=Js,o=null;if(r)try{i=r()}catch(l){o=l}var s=n._ctx,a=s.table,c=a.hook.reading.fire;this._ctx={table:a,index:s.index,isPrimKey:!s.index||a.schema.primKey.keyPath&&s.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:s.or,valueMapper:c!==Xt?c:null}})}function Jc(e,t){return e<t?-1:e===t?0:1}function Xc(e,t){return e>t?-1:e===t?0:1}function de(e,t,n){var r=e instanceof Qs?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function at(e){return new e.Collection(e,function(){return Xs("")}).limit(0)}function Qc(e){return e==="next"?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function Zc(e){return e==="next"?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function el(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),a=-1,c=0;c<s;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[c],l)<0&&(a=c)}return s<r.length&&o==="next"?e+n.substr(e.length):s<e.length&&o==="prev"?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function dn(e,t,n,r){var i,o,s,a,c,l,u,d=n.length;if(!n.every(function(v){return typeof v=="string"}))return de(e,Ys);function f(v){i=Qc(v),o=Zc(v),s=v==="next"?Jc:Xc;var m=n.map(function(b){return{lower:o(b),upper:i(b)}}).sort(function(b,w){return s(b.lower,w.lower)});a=m.map(function(b){return b.upper}),c=m.map(function(b){return b.lower}),l=v,u=v==="next"?"":r}f("next");var h=new e.Collection(e,function(){return Fe(a[0],c[d-1]+r)});h._ondirectionchange=function(v){f(v)};var p=0;return h._addAlgorithm(function(v,m,b){var w=v.key;if(typeof w!="string")return!1;var y=o(w);if(t(y,c,p))return!0;for(var g=null,_=p;_<d;++_){var S=el(w,y,a[_],c[_],s,l);S===null&&g===null?p=_+1:(g===null||s(g,S)>0)&&(g=S)}return m(g!==null?function(){v.continue(g+u)}:b),!1}),h}function Fe(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Xs(e){return{type:1,lower:e,upper:e}}var Qs=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&!(r&&i)?at(this):new this.Collection(this,function(){return Fe(t,n,!r,!i)})}catch{return de(this,Ie)}},e.prototype.equals=function(t){return t==null?de(this,Ie):new this.Collection(this,function(){return Xs(t)})},e.prototype.above=function(t){return t==null?de(this,Ie):new this.Collection(this,function(){return Fe(t,void 0,!0)})},e.prototype.aboveOrEqual=function(t){return t==null?de(this,Ie):new this.Collection(this,function(){return Fe(t,void 0,!1)})},e.prototype.below=function(t){return t==null?de(this,Ie):new this.Collection(this,function(){return Fe(void 0,t,!1,!0)})},e.prototype.belowOrEqual=function(t){return t==null?de(this,Ie):new this.Collection(this,function(){return Fe(void 0,t)})},e.prototype.startsWith=function(t){return typeof t!="string"?de(this,Ys):this.between(t,t+Ze,!0,!0)},e.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):dn(this,function(n,r){return n.indexOf(r[0])===0},[t],Ze)},e.prototype.equalsIgnoreCase=function(t){return dn(this,function(n,r){return n===r[0]},[t],"")},e.prototype.anyOfIgnoreCase=function(){var t=Ce.apply(lt,arguments);return t.length===0?at(this):dn(this,function(n,r){return r.indexOf(n)!==-1},t,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var t=Ce.apply(lt,arguments);return t.length===0?at(this):dn(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},t,Ze)},e.prototype.anyOf=function(){var t=this,n=Ce.apply(lt,arguments),r=this._cmp;try{n.sort(r)}catch{return de(this,Ie)}if(n.length===0)return at(this);var i=new this.Collection(this,function(){return Fe(n[0],n[n.length-1])});i._ondirectionchange=function(s){r=s==="next"?t._ascending:t._descending,n.sort(r)};var o=0;return i._addAlgorithm(function(s,a,c){for(var l=s.key;r(l,n[o])>0;)if(++o,o===n.length)return a(c),!1;return r(l,n[o])===0?!0:(a(function(){s.continue(n[o])}),!1)}),i},e.prototype.notEqual=function(t){return this.inAnyRange([[Yr,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var t=Ce.apply(lt,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return de(this,Ie)}var n=t.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Yr,i]]},null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(t,n){var r=this,i=this._cmp,o=this._ascending,s=this._descending,a=this._min,c=this._max;if(t.length===0)return at(this);if(!t.every(function(_){return _[0]!==void 0&&_[1]!==void 0&&o(_[0],_[1])<=0}))return de(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var l=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;function d(_,S){for(var k=0,x=_.length;k<x;++k){var I=_[k];if(i(S[0],I[1])<0&&i(S[1],I[0])>0){I[0]=a(I[0],S[0]),I[1]=c(I[1],S[1]);break}}return k===x&&_.push(S),_}var f=o;function h(_,S){return f(_[0],S[0])}var p;try{p=t.reduce(d,[]),p.sort(h)}catch{return de(this,Ie)}var v=0,m=u?function(_){return o(_,p[v][1])>0}:function(_){return o(_,p[v][1])>=0},b=l?function(_){return s(_,p[v][0])>0}:function(_){return s(_,p[v][0])>=0};function w(_){return!m(_)&&!b(_)}var y=m,g=new this.Collection(this,function(){return Fe(p[0][0],p[p.length-1][1],!l,!u)});return g._ondirectionchange=function(_){_==="next"?(y=m,f=o):(y=b,f=s),p.sort(h)},g._addAlgorithm(function(_,S,k){for(var x=_.key;y(x);)if(++v,v===p.length)return S(k),!1;return w(x)?!0:(r._cmp(x,p[v][1])===0||r._cmp(x,p[v][0])===0||S(function(){f===o?_.continue(p[v][0]):_.continue(p[v][1])}),!1)}),g},e.prototype.startsWithAnyOf=function(){var t=Ce.apply(lt,arguments);return t.every(function(n){return typeof n=="string"})?t.length===0?at(this):this.inAnyRange(t.map(function(n){return[n,n+Ze]})):de(this,"startsWithAnyOf() only works with strings")},e}();function tl(e){return tn(Qs.prototype,function(n,r,i){if(this.db=e,this._ctx={table:n,index:r===":id"?null:r,or:i},this._cmp=this._ascending=Y,this._descending=function(o,s){return Y(s,o)},this._max=function(o,s){return Y(o,s)>0?o:s},this._min=function(o,s){return Y(o,s)<0?o:s},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new K.MissingAPI})}function ge(e){return W(function(t){return $t(t),e(t.target.error),!1})}function $t(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Nt="storagemutated",Ne="x-storagemutated-1",Ge=en(null,Nt),nl=function(){function e(){}return e.prototype._lock=function(){return Ct(!j.global),++this._reculock,this._reculock===1&&!j.global&&(j.lockOwnerFor=this),this},e.prototype._unlock=function(){if(Ct(!j.global),--this._reculock===0)for(j.global||(j.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{xt(t[1],t[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&j.lockOwnerFor!==this},e.prototype.create=function(t){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Ct(!this.idbtrans),!t&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new K.DatabaseClosed(i);case"MissingAPIError":throw new K.MissingAPI(i.message,i);default:throw new K.OpenFailed(i)}if(!this.active)throw new K.TransactionInactive;return Ct(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=W(function(o){$t(o),n._reject(t.error)}),t.onabort=W(function(o){$t(o),n.active&&n._reject(new K.Abort(t.error)),n.active=!1,n.on("abort").fire(o)}),t.oncomplete=W(function(){n.active=!1,n._resolve(),"mutatedParts"in t&&Ge.storagemutated.fire(t.mutatedParts)}),this},e.prototype._promise=function(t,n,r){var i=this;if(t==="readwrite"&&this.mode!=="readwrite")return Z(new K.ReadOnly("Transaction is readonly"));if(!this.active)return Z(new K.TransactionInactive);if(this._locked())return new C(function(s,a){i._blockedFuncs.push([function(){i._promise(t,n,r).then(s,a)},j])});if(r)return qe(function(){var s=new C(function(a,c){i._lock();var l=n(a,c,i);l&&l.then&&l.then(a,c)});return s.finally(function(){return i._unlock()}),s._lib=!0,s});var o=new C(function(s,a){var c=n(s,a,i);c&&c.then&&c.then(s,a)});return o._lib=!0,o},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(t){var n=this._root(),r=C.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function s(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=n._waitingFor;return new C(function(s,a){r.then(function(c){return n._waitingQueue.push(W(s.bind(null,c)))},function(c){return n._waitingQueue.push(W(a.bind(null,c)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},e.prototype.table=function(t){var n=this._memoizedTables||(this._memoizedTables={});if(pe(n,t))return n[t];var r=this.schema[t];if(!r)throw new K.NotFound("Table "+t+" not part of transaction");var i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i},e}();function rl(e){return tn(nl.prototype,function(n,r,i,o,s){var a=this;this.db=e,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=en(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new C(function(c,l){a._resolve=c,a._reject=l}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(c){var l=a.active;return a.active=!1,a.on.error.fire(c),a.parent?a.parent._reject(c):l&&a.idbtrans&&a.idbtrans.abort(),Z(c)})})}function Gr(e,t,n,r,i,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Zs(t)}}function Zs(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ea(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:Ps(n,function(r){return[r.name,r]})}}function il(e){return e.length===1?e[0]:e}var Wt=function(e){try{return e.only([[]]),Wt=function(){return[[]]},[[]]}catch{return Wt=function(){return Ze},Ze}};function Jr(e){return e==null?function(){}:typeof e=="string"?ol(e):function(t){return Re(t,e)}}function ol(e){var t=e.split(".");return t.length===1?function(n){return n[e]}:function(n){return Re(n,e)}}function mo(e){return[].slice.call(e)}var sl=0;function Dt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function al(e,t,n){function r(d,f){var h=mo(d.objectStoreNames);return{schema:{name:d.name,tables:h.map(function(p){return f.objectStore(p)}).map(function(p){var v=p.keyPath,m=p.autoIncrement,b=oe(v),w=v==null,y={},g={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w,compound:b,keyPath:v,autoIncrement:m,unique:!0,extractKey:Jr(v)},indexes:mo(p.indexNames).map(function(_){return p.index(_)}).map(function(_){var S=_.name,k=_.unique,x=_.multiEntry,I=_.keyPath,E=oe(I),A={name:S,compound:E,keyPath:I,unique:k,multiEntry:x,extractKey:Jr(I)};return y[Dt(I)]=A,A}),getIndexByKeyPath:function(_){return y[Dt(_)]}};return y[":id"]=g.primaryKey,v!=null&&(y[Dt(v)]=g.primaryKey),g})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var f=d.lower,h=d.upper,p=d.lowerOpen,v=d.upperOpen,m=f===void 0?h===void 0?null:t.upperBound(h,!!v):h===void 0?t.lowerBound(f,!!p):t.bound(f,h,!!p,!!v);return m}function o(d){var f=d.name;function h(m){var b=m.trans,w=m.type,y=m.keys,g=m.values,_=m.range;return new Promise(function(S,k){S=W(S);var x=b.objectStore(f),I=x.keyPath==null,E=w==="put"||w==="add";if(!E&&w!=="delete"&&w!=="deleteRange")throw new Error("Invalid operation type: "+w);var A=(y||g||{length:1}).length;if(y&&g&&y.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(A===0)return S({numFailures:0,failures:{},results:[],lastResult:void 0});var T,O=[],P=[],D=0,U=function(z){++D,$t(z)};if(w==="deleteRange"){if(_.type===4)return S({numFailures:D,failures:P,results:[],lastResult:void 0});_.type===3?O.push(T=x.clear()):O.push(T=x.delete(i(_)))}else{var H=E?I?[g,y]:[g,null]:[y,null],ue=H[0],V=H[1];if(E)for(var G=0;G<A;++G)O.push(T=V&&V[G]!==void 0?x[w](ue[G],V[G]):x[w](ue[G])),T.onerror=U;else for(var G=0;G<A;++G)O.push(T=x[w](ue[G])),T.onerror=U}var re=function(z){var ce=z.target.result;O.forEach(function(N,te){return N.error!=null&&(P[te]=N.error)}),S({numFailures:D,failures:P,results:w==="delete"?y:O.map(function(N){return N.result}),lastResult:ce})};T.onerror=function(z){U(z),re(z)},T.onsuccess=re})}function p(m){var b=m.trans,w=m.values,y=m.query,g=m.reverse,_=m.unique;return new Promise(function(S,k){S=W(S);var x=y.index,I=y.range,E=b.objectStore(f),A=x.isPrimaryKey?E:E.index(x.name),T=g?_?"prevunique":"prev":_?"nextunique":"next",O=w||!("openKeyCursor"in A)?A.openCursor(i(I),T):A.openKeyCursor(i(I),T);O.onerror=ge(k),O.onsuccess=W(function(P){var D=O.result;if(!D){S(null);return}D.___id=++sl,D.done=!1;var U=D.continue.bind(D),H=D.continuePrimaryKey;H&&(H=H.bind(D));var ue=D.advance.bind(D),V=function(){throw new Error("Cursor not started")},G=function(){throw new Error("Cursor not stopped")};D.trans=b,D.stop=D.continue=D.continuePrimaryKey=D.advance=V,D.fail=W(k),D.next=function(){var re=this,z=1;return this.start(function(){return z--?re.continue():re.stop()}).then(function(){return re})},D.start=function(re){var z=new Promise(function(N,te){N=W(N),O.onerror=ge(te),D.fail=te,D.stop=function(sn){D.stop=D.continue=D.continuePrimaryKey=D.advance=G,N(sn)}}),ce=function(){if(O.result)try{re()}catch(N){D.fail(N)}else D.done=!0,D.start=function(){throw new Error("Cursor behind last entry")},D.stop()};return O.onsuccess=W(function(N){O.onsuccess=ce,ce()}),D.continue=U,D.continuePrimaryKey=H,D.advance=ue,ce(),z},S(D)},k)})}function v(m){return function(b){return new Promise(function(w,y){w=W(w);var g=b.trans,_=b.values,S=b.limit,k=b.query,x=S===1/0?void 0:S,I=k.index,E=k.range,A=g.objectStore(f),T=I.isPrimaryKey?A:A.index(I.name),O=i(E);if(S===0)return w({result:[]});if(m){var P=_?T.getAll(O,x):T.getAllKeys(O,x);P.onsuccess=function(ue){return w({result:ue.target.result})},P.onerror=ge(y)}else{var D=0,U=_||!("openKeyCursor"in T)?T.openCursor(O):T.openKeyCursor(O),H=[];U.onsuccess=function(ue){var V=U.result;if(!V)return w({result:H});if(H.push(_?V.value:V.primaryKey),++D===S)return w({result:H});V.continue()},U.onerror=ge(y)}})}}return{name:f,schema:d,mutate:h,getMany:function(m){var b=m.trans,w=m.keys;return new Promise(function(y,g){y=W(y);for(var _=b.objectStore(f),S=w.length,k=new Array(S),x=0,I=0,E,A=function(D){var U=D.target;(k[U._pos]=U.result)!=null,++I===x&&y(k)},T=ge(g),O=0;O<S;++O){var P=w[O];P!=null&&(E=_.get(w[O]),E._pos=O,E.onsuccess=A,E.onerror=T,++x)}x===0&&y(k)})},get:function(m){var b=m.trans,w=m.key;return new Promise(function(y,g){y=W(y);var _=b.objectStore(f),S=_.get(w);S.onsuccess=function(k){return y(k.target.result)},S.onerror=ge(g)})},query:v(c),openCursor:p,count:function(m){var b=m.query,w=m.trans,y=b.index,g=b.range;return new Promise(function(_,S){var k=w.objectStore(f),x=y.isPrimaryKey?k:k.index(y.name),I=i(g),E=I?x.count(I):x.count();E.onsuccess=W(function(A){return _(A.target.result)}),E.onerror=ge(S)})}}}var s=r(e,n),a=s.schema,c=s.hasGetAll,l=a.tables.map(function(d){return o(d)}),u={};return l.forEach(function(d){return u[d.name]=d}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(d){var f=u[d];if(!f)throw new Error("Table '".concat(d,"' not found"));return u[d]},MIN_KEY:-1/0,MAX_KEY:Wt(t),schema:a}}function ul(e,t){return t.reduce(function(n,r){var i=r.create;return M(M({},n),i(n))},e)}function cl(e,t,n,r){var i=n.IDBKeyRange;n.indexedDB;var o=ul(al(t,i,r),e.dbcore);return{dbcore:o}}function Bi(e,t){var n=e._novip,r=t.db,i=cl(n._middlewares,r,n._deps,t);n.core=i.dbcore,n.tables.forEach(function(o){var s=o.name;n.core.schema.tables.some(function(a){return a.name===s})&&(o.core=n.core.table(s),n[s]instanceof n.Table&&(n[s].core=o.core))})}function Wn(e,t,n,r){var i=e._novip;n.forEach(function(o){var s=r[o];t.forEach(function(a){var c=Ai(a,o);(!c||"value"in c&&c.value===void 0)&&(a===i.Transaction.prototype||a instanceof i.Transaction?Be(a,o,{get:function(){return this.table(o)},set:function(l){Os(this,o,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):a[o]=new i.Table(o,s))})})}function Xr(e,t){var n=e._novip;t.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function ll(e,t){return e._cfg.version-t._cfg.version}function fl(e,t,n,r){var i=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),a=j.transless||j;qe(function(){j.trans=o,j.transless=a,t===0?(J(i).forEach(function(c){Mi(n,c,i[c].primKey,i[c].indexes)}),Bi(e,n),C.follow(function(){return e.on.populate.fire(o)}).catch(s)):dl(e,t,o,n).catch(s)})}function dl(e,t,n,r){var i=e._novip,o=[],s=i._versions,a=i._dbSchema=Ui(i,i.idbdb,r),c=!1,l=s.filter(function(d){return d._cfg.version>=t});l.forEach(function(d){o.push(function(){var f=a,h=d._cfg.dbschema;Zr(i,f,r),Zr(i,h,r),a=i._dbSchema=h;var p=ta(f,h);p.add.forEach(function(g){Mi(r,g[0],g[1].primKey,g[1].indexes)}),p.change.forEach(function(g){if(g.recreate)throw new K.Upgrade("Not yet support for changing primary key");var _=r.objectStore(g.name);g.add.forEach(function(S){return Qr(_,S)}),g.change.forEach(function(S){_.deleteIndex(S.name),Qr(_,S)}),g.del.forEach(function(S){return _.deleteIndex(S)})});var v=d._cfg.contentUpgrade;if(v&&d._cfg.version>t){Bi(i,r),n._memoizedTables={},c=!0;var m=Ds(h);p.del.forEach(function(g){m[g]=f[g]}),Xr(i,[i.Transaction.prototype]),Wn(i,[i.Transaction.prototype],J(m),m),n.schema=m;var b=Oi(v);b&&St();var w,y=C.follow(function(){if(w=v(n),w&&b){var g=Me.bind(null,null);w.then(g,g)}});return w&&typeof w.then=="function"?C.resolve(w):y.then(function(){return w})}}),o.push(function(f){if(!c||!Fc){var h=d._cfg.dbschema;pl(h,f)}Xr(i,[i.Transaction.prototype]),Wn(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function u(){return o.length?C.resolve(o.shift()(n.idbtrans)).then(u):C.resolve()}return u().then(function(){hl(a,r)})}function ta(e,t){var n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],o=t[r];if(!i)n.add.push([r,o]);else{var s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!rr)s.recreate=!0,n.change.push(s);else{var a=i.idxByName,c=o.idxByName,l=void 0;for(l in a)c[l]||s.del.push(l);for(l in c){var u=a[l],d=c[l];u?u.src!==d.src&&s.change.push(d):s.add.push(d)}(s.del.length>0||s.add.length>0||s.change.length>0)&&n.change.push(s)}}}return n}function Mi(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(o){return Qr(i,o)}),i}function hl(e,t){J(e).forEach(function(n){t.db.objectStoreNames.contains(n)||Mi(t,n,e[n].primKey,e[n].indexes)})}function pl(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function Qr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Ui(e,t,n){var r={},i=tr(t.objectStoreNames,0);return i.forEach(function(o){for(var s=n.objectStore(o),a=s.keyPath,c=Gr(Zs(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),l=[],u=0;u<s.indexNames.length;++u){var d=s.index(s.indexNames[u]);a=d.keyPath;var f=Gr(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);l.push(f)}r[o]=ea(o,c,l)}),r}function vl(e,t,n){var r=e._novip;r.verno=t.version/10;var i=r._dbSchema=Ui(r,t,n);r._storeNames=tr(t.objectStoreNames,0),Wn(r,[r._allTables],J(i),i)}function yl(e,t){var n=Ui(e,e.idbdb,t),r=ta(n,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function Zr(e,t,n){for(var r=e._novip,i=n.db.objectStoreNames,o=0;o<i.length;++o){var s=i[o],a=n.objectStore(s);r._hasGetAll="getAll"in a;for(var c=0;c<a.indexNames.length;++c){var l=a.indexNames[c],u=a.index(l).keyPath,d=typeof u=="string"?u:"["+tr(u).join("+")+"]";if(t[s]){var f=t[s].idxByName[d];f&&(f.name=l,delete t[s].idxByName[d],t[s].idxByName[l]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&$.WorkerGlobalScope&&$ instanceof $.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function ml(e){return e.split(",").map(function(t,n){t=t.trim();var r=t.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Gr(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),oe(i),n===0)})}var bl=function(){function e(){}return e.prototype._parseStoresSpec=function(t,n){J(t).forEach(function(r){if(t[r]!==null){var i=ml(t[r]),o=i.shift();if(o.multi)throw new K.Schema("Primary key cannot be multi-valued");i.forEach(function(s){if(s.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),n[r]=ea(r,o,i)}})},e.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?ae(this._cfg.storesSource,t):t;var r=n._versions,i={},o={};return r.forEach(function(s){ae(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),n._dbSchema=o,Xr(n,[n._allTables,n,n.Transaction.prototype]),Wn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],J(o),o),n._storeNames=J(o),this},e.prototype.upgrade=function(t){return this._cfg.contentUpgrade=Pi(this._cfg.contentUpgrade||F,t),this},e}();function gl(e){return tn(bl.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Li(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new q(ir,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Fi(e){return e&&typeof e.databases=="function"}function wl(e){var t=e.indexedDB,n=e.IDBKeyRange;return Fi(t)?Promise.resolve(t.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==ir})}):Li(t,n).toCollection().primaryKeys()}function _l(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Fi(n)&&t!==ir&&Li(n,r).put({name:t}).catch(F)}function Sl(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Fi(n)&&t!==ir&&Li(n,r).delete(t).catch(F)}function ei(e){return qe(function(){return j.letThrough=!0,e()})}function xl(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)})}function kl(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Z(t.dbOpenError):e});Ee&&(t.openCanceller._stackHolder=ot()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new K.DatabaseClosed("db.open() was cancelled")}var o=t.dbReadyResolve,s=null,a=!1;return C.race([r,(typeof navigator>"u"?C.resolve():xl()).then(function(){return new C(function(c,l){if(i(),!n)throw new K.MissingAPI;var u=e.name,d=t.autoSchema?n.open(u):n.open(u,Math.round(e.verno*10));if(!d)throw new K.MissingAPI;d.onerror=ge(l),d.onblocked=W(e._fireOnBlocked),d.onupgradeneeded=W(function(f){if(s=d.transaction,t.autoSchema&&!e._options.allowEmptyDB){d.onerror=$t,s.abort(),d.result.close();var h=n.deleteDatabase(u);h.onsuccess=h.onerror=W(function(){l(new K.NoSuchDatabase("Database ".concat(u," doesnt exist")))})}else{s.onerror=ge(l);var p=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=p<1,e._novip.idbdb=d.result,fl(e,p/10,s,l)}},l),d.onsuccess=W(function(){s=null;var f=e._novip.idbdb=d.result,h=tr(f.objectStoreNames);if(h.length>0)try{var p=f.transaction(il(h),"readonly");t.autoSchema?vl(e,f,p):(Zr(e,e._dbSchema,p),yl(e,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Bi(e,p)}catch{}Pt.push(e),f.onversionchange=W(function(v){t.vcFired=!0,e.on("versionchange").fire(v)}),f.onclose=W(function(v){e.on("close").fire(v)}),a&&_l(e._deps,u),c()},l)})})]).then(function(){return i(),t.onReadyBeingFired=[],C.resolve(ei(function(){return e.on.ready.fire(e.vip)})).then(function c(){if(t.onReadyBeingFired.length>0){var l=t.onReadyBeingFired.reduce(Pi,F);return t.onReadyBeingFired=[],C.resolve(ei(function(){return l(e.vip)})).then(c)}})}).finally(function(){t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(function(){return e}).catch(function(c){t.dbOpenError=c;try{s&&s.abort()}catch{}return r===t.openCanceller&&e._close(),Z(c)}).finally(function(){t.openComplete=!0,o()})}function ti(e){var t=function(s){return e.next(s)},n=function(s){return e.throw(s)},r=o(t),i=o(n);function o(s){return function(a){var c=s(a),l=c.value;return c.done?l:!l||typeof l.then!="function"?oe(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return o(t)()}function El(e,t,n){var r=arguments.length;if(r<2)throw new K.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=Rs(i);return[e,o,n]}function na(e,t,n,r,i){return C.resolve().then(function(){var o=j.transless||j,s=e._createTransaction(t,n,e._dbSchema,r),a={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(d){return d.name===Ti.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(function(){return na(e,t,n,null,i)})):Z(d)}var c=Oi(i);c&&St();var l,u=C.follow(function(){if(l=i.call(s,s),l)if(c){var d=Me.bind(null,null);l.then(d,d)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=ti(l))},a);return(l&&typeof l.then=="function"?C.resolve(l).then(function(d){return s.active?d:Z(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):u.then(function(){return l})).then(function(d){return r&&s._resolve(),s._completion.then(function(){return d})}).catch(function(d){return s._reject(d),Z(d)})})}function hn(e,t,n){for(var r=oe(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Il(e){return M(M({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},o=[];function s(v,m,b){var w=Dt(v),y=i[w]=i[w]||[],g=v==null?0:typeof v=="string"?1:v.length,_=m>0,S=M(M({},b),{isVirtual:_,keyTail:m,keyLength:g,extractKey:Jr(v),unique:!_&&b.unique});if(y.push(S),S.isPrimaryKey||o.push(S),g>1){var k=g===2?v[0]:v.slice(0,g-1);s(k,m+1,b)}return y.sort(function(x,I){return x.keyTail-I.keyTail}),S}var a=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(var c=0,l=r.indexes;c<l.length;c++){var u=l[c];s(u.keyPath,0,u)}function d(v){var m=i[Dt(v)];return m&&m[0]}function f(v,m){return{type:v.type===1?2:v.type,lower:hn(v.lower,v.lowerOpen?e.MAX_KEY:e.MIN_KEY,m),lowerOpen:!0,upper:hn(v.upper,v.upperOpen?e.MIN_KEY:e.MAX_KEY,m),upperOpen:!0}}function h(v){var m=v.query.index;return m.isVirtual?M(M({},v),{query:{index:m,range:f(v.query.range,m.keyTail)}}):v}var p=M(M({},n),{schema:M(M({},r),{primaryKey:a,indexes:o,getIndexByKeyPath:d}),count:function(v){return n.count(h(v))},query:function(v){return n.query(h(v))},openCursor:function(v){var m=v.query.index,b=m.keyTail,w=m.isVirtual,y=m.keyLength;if(!w)return n.openCursor(v);function g(_){function S(x){x!=null?_.continue(hn(x,v.reverse?e.MAX_KEY:e.MIN_KEY,b)):v.unique?_.continue(_.key.slice(0,y).concat(v.reverse?e.MIN_KEY:e.MAX_KEY,b)):_.continue()}var k=Object.create(_,{continue:{value:S},continuePrimaryKey:{value:function(x,I){_.continuePrimaryKey(hn(x,e.MAX_KEY,b),I)}},primaryKey:{get:function(){return _.primaryKey}},key:{get:function(){var x=_.key;return y===1?x[0]:x.slice(0,y)}},value:{get:function(){return _.value}}});return k}return n.openCursor(h(v)).then(function(_){return _&&g(_)})}});return p}})}var Al={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Il};function $i(e,t,n,r){return n=n||{},r=r||"",J(e).forEach(function(i){if(!pe(t,i))n[r+i]=void 0;else{var o=e[i],s=t[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){var a=Br(o),c=Br(s);a!==c?n[r+i]=t[i]:a==="Object"?$i(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}}),J(t).forEach(function(i){pe(e,i)||(n[r+i]=t[i])}),n}function Ol(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Cl={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return M(M({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey,i=M(M({},n),{mutate:function(o){var s=j.trans,a=s.table(t).hook,c=a.deleting,l=a.creating,u=a.updating;switch(o.type){case"add":if(l.fire===F)break;return s._promise("readwrite",function(){return d(o)},!0);case"put":if(l.fire===F&&u.fire===F)break;return s._promise("readwrite",function(){return d(o)},!0);case"delete":if(c.fire===F)break;return s._promise("readwrite",function(){return d(o)},!0);case"deleteRange":if(c.fire===F)break;return s._promise("readwrite",function(){return f(o)},!0)}return n.mutate(o);function d(p){var v=j.trans,m=p.keys||Ol(r,p);if(!m)throw new Error("Keys missing");return p=p.type==="add"||p.type==="put"?M(M({},p),{keys:m}):M({},p),p.type!=="delete"&&(p.values=jr([],p.values,!0)),p.keys&&(p.keys=jr([],p.keys,!0)),Tl(n,p,m).then(function(b){var w=m.map(function(y,g){var _=b[g],S={onerror:null,onsuccess:null};if(p.type==="delete")c.fire.call(S,y,_,v);else if(p.type==="add"||_===void 0){var k=l.fire.call(S,y,p.values[g],v);y==null&&k!=null&&(y=k,p.keys[g]=y,r.outbound||he(p.values[g],r.keyPath,y))}else{var x=$i(_,p.values[g]),I=u.fire.call(S,x,y,_,v);if(I){var E=p.values[g];Object.keys(I).forEach(function(A){pe(E,A)?E[A]=I[A]:he(E,A,I[A])})}}return S});return n.mutate(p).then(function(y){for(var g=y.failures,_=y.results,S=y.numFailures,k=y.lastResult,x=0;x<m.length;++x){var I=_?_[x]:m[x],E=w[x];I==null?E.onerror&&E.onerror(g[x]):E.onsuccess&&E.onsuccess(p.type==="put"&&b[x]?p.values[x]:I)}return{failures:g,results:_,numFailures:S,lastResult:k}}).catch(function(y){return w.forEach(function(g){return g.onerror&&g.onerror(y)}),Promise.reject(y)})})}function f(p){return h(p.trans,p.range,1e4)}function h(p,v,m){return n.query({trans:p,values:!1,query:{index:r,range:v},limit:m}).then(function(b){var w=b.result;return d({type:"delete",keys:w,trans:p}).then(function(y){return y.numFailures>0?Promise.reject(y.failures[0]):w.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(p,M(M({},v),{lower:w[w.length-1],lowerOpen:!0}),m)})})}}});return i}})}};function Tl(e,t,n){return t.type==="add"?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function ra(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)Y(t.keys[i],e[o])===0&&(r.push(n?Jt(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch{return null}}var Pl={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return M(M({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=ra(r.keys,r.trans._cache,r.cache==="clone");return i?C.resolve(i):n.getMany(r).then(function(o){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Jt(o):o},o})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},Sr;function Ni(e){return!("from"in e)}var Oe=function(e,t){if(this)ae(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new Oe;return e&&"d"in e&&ae(n,e),n}};mt(Oe.prototype,(Sr={add:function(e){return Hn(this,e),this},addKey:function(e){return Ht(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Ht(t,n,n)}),this}},Sr[Mr]=function(){return ni(this)},Sr));function Ht(e,t,n){var r=Y(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Ni(e))return ae(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Y(n,e.from)<0)return i?Ht(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},bo(e);if(Y(t,e.to)>0)return o?Ht(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},bo(e);Y(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Y(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var s=!e.r;i&&!e.l&&Hn(e,i),o&&s&&Hn(e,o)}}function Hn(e,t){function n(r,i){var o=i.from,s=i.to,a=i.l,c=i.r;Ht(r,o,s),a&&n(r,a),c&&n(r,c)}Ni(t)||n(e,t)}function Dl(e,t){var n=ni(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=ni(e),s=o.next(i.from),a=s.value;!r.done&&!s.done;){if(Y(a.from,i.to)<=0&&Y(a.to,i.from)>=0)return!0;Y(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function ni(e){var t=Ni(e)?null:{s:0,n:e};return{next:function(n){for(var r=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Y(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Y(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function bo(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var o=i==="r"?"l":"r",s=M({},e),a=e[i];e.from=a.from,e.to=a.to,e[i]=a[i],s[i]=a[o],e[o]=s,s.d=go(s)}e.d=go(e)}function go(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}var Rl={stack:"dbcore",level:0,create:function(e){var t=e.schema.name,n=new Oe(e.MIN_KEY,e.MAX_KEY);return M(M({},e),{table:function(r){var i=e.table(r),o=i.schema,s=o.primaryKey,a=s.extractKey,c=s.outbound,l=M(M({},i),{mutate:function(f){var h=f.trans,p=h.mutatedParts||(h.mutatedParts={}),v=function(k){var x="idb://".concat(t,"/").concat(r,"/").concat(k);return p[x]||(p[x]=new Oe)},m=v(""),b=v(":dels"),w=f.type,y=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],g=y[0],_=y[1],S=f.trans._cache;return i.mutate(f).then(function(k){if(oe(g)){w!=="delete"&&(g=k.results),m.addKeys(g);var x=ra(g,S);!x&&w!=="add"&&b.addKeys(g),(x||_)&&jl(v,o,x,_)}else if(g){var I={from:g.lower,to:g.upper};b.add(I),m.add(I)}else m.add(n),b.add(n),o.indexes.forEach(function(E){return v(E.name).add(n)});return k})}}),u=function(f){var h,p,v=f.query,m=v.index,b=v.range;return[m,new Oe((h=b.lower)!==null&&h!==void 0?h:e.MIN_KEY,(p=b.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},d={get:function(f){return[s,new Oe(f.key)]},getMany:function(f){return[s,new Oe().addKeys(f.keys)]},count:u,query:u,openCursor:u};return J(d).forEach(function(f){l[f]=function(h){var p=j.subscr;if(p){var v=function(S){var k="idb://".concat(t,"/").concat(r,"/").concat(S);return p[k]||(p[k]=new Oe)},m=v(""),b=v(":dels"),w=d[f](h),y=w[0],g=w[1];if(v(y.name||"").add(g),!y.isPrimaryKey)if(f==="count")b.add(n);else{var _=f==="query"&&c&&h.values&&i.query(M(M({},h),{values:!1}));return i[f].apply(this,arguments).then(function(S){if(f==="query"){if(c&&h.values)return _.then(function(E){var A=E.result;return m.addKeys(A),S});var k=h.values?S.result.map(a):S.result;h.values?m.addKeys(k):b.addKeys(k)}else if(f==="openCursor"){var x=S,I=h.values;return x&&Object.create(x,{key:{get:function(){return b.addKey(x.primaryKey),x.key}},primaryKey:{get:function(){var E=x.primaryKey;return b.addKey(E),E}},value:{get:function(){return I&&m.addKey(x.primaryKey),x.value}}})}return S})}}return i[f].apply(this,arguments)}}),l}})}};function jl(e,t,n,r){function i(o){var s=e(o.name||"");function a(l){return l!=null?o.extractKey(l):null}var c=function(l){return o.multiEntry&&oe(l)?l.forEach(function(u){return s.addKey(u)}):s.addKey(l)};(n||r).forEach(function(l,u){var d=n&&a(n[u]),f=r&&a(r[u]);Y(d,f)!==0&&(d!=null&&c(d),f!=null&&c(f))})}t.indexes.forEach(i)}var q=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=M({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var o=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new C(function(a){s.dbReadyResolve=a}),s.openCanceller=new C(function(a,c){s.cancelOpen=c}),this._state=s,this.name=t,this.on=en(this,"populate","blocked","versionchange","close",{ready:[Pi,F]}),this.on.ready.subscribe=Cs(this.on.ready.subscribe,function(a){return function(c,l){e.vip(function(){var u=r._state;if(u.openComplete)u.dbOpenError||C.resolve().then(c),l&&a(c);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(c),l&&a(c);else{a(c);var d=r;l||a(function f(){d.on.ready.unsubscribe(c),d.on.ready.unsubscribe(f)})}})}}),this.Collection=Gc(this),this.Table=zc(this),this.Transaction=rl(this),this.Version=gl(this),this.WhereClause=tl(this),this.on("versionchange",function(a){a.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close()}),this.on("blocked",function(a){!a.newVersion||a.newVersion<a.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(a.oldVersion/10))}),this._maxKey=Wt(n.IDBKeyRange),this._createTransaction=function(a,c,l,u){return new r.Transaction(a,c,l,r._options.chromeTransactionDurability,u)},this._fireOnBlocked=function(a){r.on("blocked").fire(a),Pt.filter(function(c){return c.name===r.name&&c!==r&&!c._state.vcFired}).map(function(c){return c.on("versionchange").fire(a)})},this.use(Al),this.use(Cl),this.use(Rl),this.use(Pl),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach(function(a){return a(r)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new K.Type("Given version is not a positive number");if(t=Math.round(t*10)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=this._versions,r=n.filter(function(i){return i._cfg.version===t})[0];return r||(r=new this.Version(t),n.push(r),n.sort(ll),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(t){var n=this;return this.idbdb&&(this._state.openComplete||j.letThrough||this._vip)?t():new C(function(r,i){if(n._state.openComplete)return i(new K.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new K.DatabaseClosed);return}n.open().catch(F)}n._state.dbReadyPromise.then(r,i)}).then(t)},e.prototype.use=function(t){var n=t.stack,r=t.create,i=t.level,o=t.name;o&&this.unuse({stack:n,name:o});var s=this._middlewares[n]||(this._middlewares[n]=[]);return s.push({stack:n,create:r,level:i??10,name:o}),s.sort(function(a,c){return a.level-c.level}),this},e.prototype.unuse=function(t){var n=t.stack,r=t.name,i=t.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(o){return i?o.create!==i:r?o.name!==r:!1})),this},e.prototype.open=function(){return kl(this)},e.prototype._close=function(){var t=this._state,n=Pt.indexOf(this);if(n>=0&&Pt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new C(function(r){t.dbReadyResolve=r}),t.openCanceller=new C(function(r,i){t.cancelOpen=i})},e.prototype.close=function(){this._close();var t=this._state;this._options.autoOpen=!1,t.dbOpenError=new K.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)},e.prototype.delete=function(){var t=this,n=arguments.length>0,r=this._state;return new C(function(i,o){var s=function(){t.close();var a=t._deps.indexedDB.deleteDatabase(t.name);a.onsuccess=W(function(){Sl(t._deps,t.name),i()}),a.onerror=ge(o),a.onblocked=t._fireOnBlocked};if(n)throw new K.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return J(this._allTables).map(function(n){return t._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var t=El.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,n,r){var i=this,o=j.trans;(!o||o.db!==this||t.indexOf("!")!==-1)&&(o=null);var s=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");var a,c;try{if(c=n.map(function(u){var d=u instanceof i.Table?u.name:u;if(typeof d!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return d}),t=="r"||t===mr)a=mr;else if(t=="rw"||t==br)a=br;else throw new K.InvalidArgument("Invalid transaction mode: "+t);if(o){if(o.mode===mr&&a===br)if(s)o=null;else throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o&&c.forEach(function(u){if(o&&o.storeNames.indexOf(u)===-1)if(s)o=null;else throw new K.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&o&&!o.active&&(o=null)}}catch(u){return o?o._promise(null,function(d,f){f(u)}):Z(u)}var l=na.bind(null,this,a,c,o,r);return o?o._promise(a,l,"lock"):j.trans?xt(j.transless,function(){return i._whenReady(l)}):this._whenReady(l)},e.prototype.table=function(t){if(!pe(this._allTables,t))throw new K.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},e}(),Kl=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Bl=function(){function e(t){this._subscribe=t}return e.prototype.subscribe=function(t,n,r){return this._subscribe(!t||typeof t=="function"?{next:t,error:n,complete:r}:t)},e.prototype[Kl]=function(){return this},e}();function ia(e,t){return J(t).forEach(function(n){var r=e[n]||(e[n]=new Oe);Hn(r,t[n])}),e}var Vn;try{Vn={indexedDB:$.indexedDB||$.mozIndexedDB||$.webkitIndexedDB||$.msIndexedDB,IDBKeyRange:$.IDBKeyRange||$.webkitIDBKeyRange}}catch{Vn={indexedDB:null,IDBKeyRange:null}}function Ve(e){return new Bl(function(t){var n=Oi(e);function r(h){n&&St();var p=function(){return qe(e,{subscr:h,trans:null})},v=j.trans?xt(j.transless,p):p();return n&&v.then(Me,Me),v}var i=!1,o={},s={},a={get closed(){return i},unsubscribe:function(){i=!0,Ge.storagemutated.unsubscribe(d)}};t.start&&t.start(a);var c=!1,l=!1;function u(){return J(s).some(function(h){return o[h]&&Dl(o[h],s[h])})}var d=function(h){ia(o,h),u()&&f()},f=function(){if(!(c||i||!Vn.indexedDB)){o={};var h={},p=r(h);l||(Ge(Nt,d),l=!0),c=!0,Promise.resolve(p).then(function(v){c=!1,!i&&(u()?f():(o={},s=h,t.next&&t.next(v)))},function(v){["DatabaseClosedError","AbortError"].includes(v?.name)||(c=!1,t.error&&t.error(v),a.unsubscribe())})}};return f(),a})}var Qe=q;mt(Qe,M(M({},nr),{delete:function(e){var t=new Qe(e,{addons:[]});return t.delete()},exists:function(e){return new Qe(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return wl(Qe.dependencies).then(e)}catch{return Z(new K.MissingAPI)}},defineClass:function(){function e(t){ae(this,t)}return e},ignoreTransaction:function(e){return j.trans?xt(j.transless,e):e()},vip:ei,async:function(e){return function(){try{var t=ti(e.apply(this,arguments));return!t||typeof t.then!="function"?C.resolve(t):t}catch(n){return Z(n)}}},spawn:function(e,t,n){try{var r=ti(e.apply(n,t||[]));return!r||typeof r.then!="function"?C.resolve(r):r}catch(i){return Z(i)}},currentTransaction:{get:function(){return j.trans||null}},waitFor:function(e,t){var n=C.resolve(typeof e=="function"?Qe.ignoreTransaction(e):e).timeout(t||6e4);return j.trans?j.trans.waitFor(n):n},Promise:C,debug:{get:function(){return Ee},set:function(e){Ks(e,e==="dexie"?function(){return!0}:Gs)}},derive:wt,extend:ae,props:mt,override:Cs,Events:en,on:Ge,liveQuery:Ve,extendObservabilitySet:ia,getByKeyPath:Re,setByKeyPath:he,delByKeyPath:pc,shallowClone:Ds,deepClone:Jt,getObjectDiff:$i,cmp:Y,asap:Ts,minKey:Yr,addons:[],connections:Pt,errnames:Ti,dependencies:Vn,semVer:fo,version:fo.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,n*2)})}));Qe.maxKey=Wt(Qe.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ge(Nt,function(e){if(!Te){var t;rr?(t=document.createEvent("CustomEvent"),t.initCustomEvent(Ne,!0,!0,e)):t=new CustomEvent(Ne,{detail:e}),Te=!0,dispatchEvent(t),Te=!1}}),addEventListener(Ne,function(e){var t=e.detail;Te||zn(t)}));function zn(e){var t=Te;try{Te=!0,Ge.storagemutated.fire(e)}finally{Te=t}}var Te=!1;if(typeof BroadcastChannel<"u"){var pn=new BroadcastChannel(Ne);typeof pn.unref=="function"&&pn.unref(),Ge(Nt,function(e){Te||pn.postMessage(e)}),pn.onmessage=function(e){e.data&&zn(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ge(Nt,function(e){try{Te||(typeof localStorage<"u"&&localStorage.setItem(Ne,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&jr([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(t){return t.postMessage({type:Ne,changedParts:e})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(e){if(e.key===Ne){var t=JSON.parse(e.newValue);t&&zn(t.changedParts)}});var wo=self.document&&navigator.serviceWorker;wo&&wo.addEventListener("message",Ml)}function Ml(e){var t=e.data;t&&t.type===Ne&&zn(t.changedParts)}C.rejectionMapper=xc;Ks(Ee,Gs);var ri=function(e,t){return ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},ri(e,t)};function kt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ri(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function R(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(u){o(u)}}function a(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(d){d(u)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function oa(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!((i=i.length>0&&i[i.length-1])||u[0]!==6&&u[0]!==2)){s=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(u[0]===6&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(d){u=[6,d],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,l])}}}function qn(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Vt(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(t===void 0||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function zt(e,t,n){if(n||arguments.length===2)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function pt(e){return this instanceof pt?(this.v=e,this):new pt(e)}function Ul(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(d){i[d]&&(r[d]=function(f){return new Promise(function(h,p){o.push([d,f,h,p])>1||a(d,f)})})}function a(d,f){try{(function(h){h.value instanceof pt?Promise.resolve(h.value.v).then(c,l):u(o[0][2],h)})(i[d](f))}catch(h){u(o[0][3],h)}}function c(d){a("next",d)}function l(d){a("throw",d)}function u(d,f){d(f),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Ll(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=qn(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(o){return new Promise(function(s,a){(function(c,l,u,d){Promise.resolve(d).then(function(f){c({value:f,done:u})},l)})(s,a,(o=e[i](o)).done,o.value)})}}}function sa(e){if(!e)throw new Error("Assertion Failed")}const Fl={}.hasOwnProperty;function Yn(e,t,n){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){sa(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)Yn(e,t[r],n[r])}else{var o=t.indexOf(".");if(o!==-1){var s=t.substr(0,o),a=t.substr(o+1);if(a==="")n===void 0?Array.isArray(e)?isNaN(parseInt(s))||e.splice(parseInt(s),1):delete e[s]:e[s]=n;else{var c=e[s];c&&function(l,u){return Fl.call(l,u)}(e,s)||(c=e[s]={}),Yn(c,a,n)}}else n===void 0?Array.isArray(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}const aa=typeof self<"u"&&typeof crypto<"u"?(e,t=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(e);return t(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(e,t=$l)=>{const n=Buffer.alloc(e);return t(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function $l(e){for(let t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}function Wi(e){return typeof e=="string"||!!(Array.isArray(e)&&e.some(t=>Wi(t))&&e.every(ua))}function ua(e){return typeof e=="string"||typeof e=="number"||Array.isArray(e)&&e.every(ua)}function Nl(e,t,n){const r=e[t]||(e[t]={}),i=n.keys.map(o=>typeof o=="string"?o:JSON.stringify(o));switch(n.type){case"insert":case"upsert":i.forEach((o,s)=>{r[o]={type:"ups",val:n.values[s]}});break;case"update":case"modify":i.forEach((o,s)=>{const a=n.type==="update"?n.changeSpecs[s]:n.changeSpec,c=r[o];if(c)switch(c.type){case"ups":for(const[l,u]of Object.entries(a))Yn(c.val,l,u);break;case"del":break;case"upd":Object.assign(c.mod,a)}else r[o]={type:"upd",mod:a}});break;case"delete":i.forEach(o=>{r[o]={type:"del"}})}return e}function _o(e,t){for(const{table:n,muts:r}of t)for(const i of r)Nl(e,n,i)}function X(e){return typeof e=="function"}function fe(e){return function(t){if(function(n){return X(n?.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}var ca=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function la(e){return X(e?.then)}function fa(e){var t=e(function(n){Error.call(n),n.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var xr=fa(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ii(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var or=function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var n,r,i,o,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var c=qn(a),l=c.next();!l.done;l=c.next())l.value.remove(this)}catch(v){n={error:v}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}else a.remove(this);var u=this.initialTeardown;if(X(u))try{u()}catch(v){s=v instanceof xr?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=qn(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{So(p)}catch(v){s=s??[],v instanceof xr?s=zt(zt([],Vt(s)),Vt(v.errors)):s.push(v)}}}catch(v){i={error:v}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}if(s)throw new xr(s)}},e.prototype.add=function(n){var r;if(n&&n!==this)if(this.closed)So(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(n)}},e.prototype._hasParent=function(n){var r=this._parentage;return r===n||Array.isArray(r)&&r.includes(n)},e.prototype._addParent=function(n){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(n),r):r?[r,n]:n},e.prototype._removeParent=function(n){var r=this._parentage;r===n?this._parentage=null:Array.isArray(r)&&ii(r,n)},e.prototype.remove=function(n){var r=this._finalizers;r&&ii(r,n),n instanceof e&&n._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function da(e){return e instanceof or||e&&"closed"in e&&X(e.remove)&&X(e.add)&&X(e.unsubscribe)}function So(e){X(e)?e():e.unsubscribe()}or.EMPTY;var ha={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Wl={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,zt([e,t],Vt(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function pa(e){Wl.setTimeout(function(){throw e})}function oi(){}var Hi=function(e){function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,da(n)&&n.add(r)):r.destination=zl,r}return kt(t,e),t.create=function(n,r,i){return new si(n,r,i)},t.prototype.next=function(n){this.isStopped?void 0:this._next(n)},t.prototype.error=function(n){this.isStopped?void 0:(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped?void 0:(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(or),Hl=Function.prototype.bind;function kr(e,t){return Hl.call(e,t)}var Vl=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){vn(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){vn(r)}else vn(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){vn(n)}},e}(),si=function(e){function t(n,r,i){var o,s,a=e.call(this)||this;return X(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:a&&ha.useDeprecatedNextContext?((s=Object.create(n)).unsubscribe=function(){return a.unsubscribe()},o={next:n.next&&kr(n.next,s),error:n.error&&kr(n.error,s),complete:n.complete&&kr(n.complete,s)}):o=n,a.destination=new Vl(o),a}return kt(t,e),t}(Hi);function vn(e){pa(e)}var zl={closed:!0,next:oi,error:function(e){throw e},complete:oi},Vi=typeof Symbol=="function"&&Symbol.observable||"@@observable";function sr(e){return e}function ql(e){return e.length===0?sr:e.length===1?e[0]:function(t){return e.reduce(function(n,r){return r(n)},t)}}var me=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var i,o=this,s=(i=t)&&i instanceof Hi||function(a){return a&&X(a.next)&&X(a.error)&&X(a.complete)}(i)&&da(i)?t:new si(t,n,r);return function(a){a()}(function(){var a=o,c=a.operator,l=a.source;s.add(c?c.call(s,l):l?o._subscribe(s):o._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return new(n=xo(n))(function(i,o){var s=new si({next:function(a){try{t(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[Vi]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return ql(t)(this)},e.prototype.toPromise=function(t){var n=this;return new(t=xo(t))(function(r,i){var o;n.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},e.create=function(t){return new e(t)},e}();function xo(e){var t;return(t=e??ha.Promise)!==null&&t!==void 0?t:Promise}function va(e){return X(e[Vi])}function ya(e){return Symbol.asyncIterator&&X(e?.[Symbol.asyncIterator])}function ma(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var ba=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator";function ga(e){return X(e?.[ba])}function wa(e){return Ul(this,arguments,function(){var t,n,r;return oa(this,function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,pt(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,pt(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,pt(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function _a(e){return X(e?.getReader)}function Je(e){if(e instanceof me)return e;if(e!=null){if(va(e))return i=e,new me(function(o){var s=i[Vi]();if(X(s.subscribe))return s.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(ca(e))return r=e,new me(function(o){for(var s=0;s<r.length&&!o.closed;s++)o.next(r[s]);o.complete()});if(la(e))return n=e,new me(function(o){n.then(function(s){o.closed||(o.next(s),o.complete())},function(s){return o.error(s)}).then(null,pa)});if(ya(e))return ko(e);if(ga(e))return t=e,new me(function(o){var s,a;try{for(var c=qn(t),l=c.next();!l.done;l=c.next()){var u=l.value;if(o.next(u),o.closed)return}}catch(d){s={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}o.complete()});if(_a(e))return ko(wa(e))}var t,n,r,i;throw ma(e)}function ko(e){return new me(function(t){(function(n,r){var i,o,s,a;return R(this,void 0,void 0,function(){var c,l;return oa(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),i=Ll(n),u.label=1;case 1:return[4,i.next()];case 2:if((o=u.sent()).done)return[3,4];if(c=o.value,r.next(c),r.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=u.sent(),s={error:l},[3,11];case 6:return u.trys.push([6,,9,10]),o&&!o.done&&(a=i.return)?[4,a.call(i)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})})(e,t).catch(function(n){return t.error(n)})})}function le(e,t,n,r,i){return new Yl(e,t,n,r,i)}var Yl=function(e){function t(n,r,i,o,s,a){var c=e.call(this,n)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:e.prototype._next,c._error=o?function(l){try{o(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:e.prototype._complete,c}return kt(t,e),t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(Hi),Gl=function(e){function t(n,r){return e.call(this)||this}return kt(t,e),t.prototype.schedule=function(n,r){return this},t}(or),ai={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=ai.delegate;return i?.setInterval?i.setInterval.apply(i,zt([e,t],Vt(n))):setInterval.apply(void 0,zt([e,t],Vt(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Jl=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return kt(t,e),t.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(o,this.id,r),this},t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),ai.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;ai.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var i,o=!1;try{this.work(n)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var n=this.id,r=this.scheduler,i=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ii(i,this),n!=null&&(this.id=this.recycleAsyncId(r,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Gl),Xl={now:function(){return Date.now()},delegate:void 0},Eo=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=Xl.now,e}(),ar=new(function(e){function t(n,r){r===void 0&&(r=Eo.now);var i=e.call(this,n,r)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return kt(t,e),t.prototype.flush=function(n){var r=this.actions;if(this._active)r.push(n);else{var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}}},t}(Eo))(Jl),Ql=ar;function Sa(e){return e&&X(e.schedule)}function xa(e){return e instanceof Date&&!isNaN(e)}function ka(e){return Sa((t=e)[t.length-1])?e.pop():void 0;var t}function je(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function ui(e){return fe(function(t,n){var r,i=null,o=!1;i=t.subscribe(le(n,void 0,void 0,function(s){r=Je(e(s,ui(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):o=!0})),o&&(i.unsubscribe(),i=null,r.subscribe(n))})}function Io(e,t){return t===void 0&&(t=0),fe(function(n,r){n.subscribe(le(r,function(i){return je(r,e,function(){return r.next(i)},t)},function(){return je(r,e,function(){return r.complete()},t)},function(i){return je(r,e,function(){return r.error(i)},t)}))})}function Ao(e,t){return t===void 0&&(t=0),fe(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Oo(e,t){if(!e)throw new Error("Iterable cannot be null");return new me(function(n){je(n,t,function(){var r=e[Symbol.asyncIterator]();je(n,t,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Zl(e,t){if(e!=null){if(va(e))return function(n,r){return Je(n).pipe(Ao(r),Io(r))}(e,t);if(ca(e))return function(n,r){return new me(function(i){var o=0;return r.schedule(function(){o===n.length?i.complete():(i.next(n[o++]),i.closed||this.schedule())})})}(e,t);if(la(e))return function(n,r){return Je(n).pipe(Ao(r),Io(r))}(e,t);if(ya(e))return Oo(e,t);if(ga(e))return function(n,r){return new me(function(i){var o;return je(i,r,function(){o=n[ba](),je(i,r,function(){var s,a,c;try{a=(s=o.next()).value,c=s.done}catch(l){return void i.error(l)}c?i.complete():i.next(a)},0,!0)}),function(){return X(o?.return)&&o.return()}})}(e,t);if(_a(e))return function(n,r){return Oo(wa(n),r)}(e,t)}throw ma(e)}function ef(e,t){return t?Zl(e,t):Je(e)}function xe(e,t){return fe(function(n,r){var i=0;n.subscribe(le(r,function(o){r.next(e.call(t,o,i++))}))})}function zi(e,t,n){return n===void 0&&(n=1/0),X(t)?zi(function(r,i){return xe(function(o,s){return t(r,o,i,s)})(Je(e(r,i)))},n):(typeof t=="number"&&(n=t),fe(function(r,i){return function(o,s,a,c,l,u,d,f){var h=[],p=0,v=0,m=!1,b=function(){!m||h.length||p||s.complete()},w=function(g){return p<c?y(g):h.push(g)},y=function(g){u&&s.next(g),p++;var _=!1;Je(a(g,v++)).subscribe(le(s,function(S){l?.(S),u?w(S):s.next(S)},function(){_=!0},void 0,function(){if(_)try{p--;for(var S=function(){var k=h.shift();d?je(s,d,function(){return y(k)}):y(k)};h.length&&p<c;)S();b()}catch(k){s.error(k)}}))};return o.subscribe(le(s,w,function(){m=!0,b()})),function(){f?.()}}(r,i,e,n)}))}function tf(){return(e=1)===void 0&&(e=1/0),zi(sr,e);var e}function Co(e,t){return t===void 0&&(t=ar),fe(function(n,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+e,u=t.now();if(u<l)return i=this.schedule(void 0,l-u),void r.add(i);a()}n.subscribe(le(r,function(l){o=l,s=t.now(),i||(i=t.schedule(c,e),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function ci(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tf()(ef(e,ka(e)))}var nf=new me(function(e){return e.complete()});function _e(e){return e<=0?function(){return nf}:fe(function(t,n){var r=0;t.subscribe(le(n,function(i){++r<=e&&(n.next(i),e<=r&&n.complete())}))})}function Ea(e,t){return t?function(n){return ci(t.pipe(_e(1),fe(function(r,i){r.subscribe(le(i,oi))})),n.pipe(Ea(e)))}:zi(function(n,r){return e(n,r).pipe(_e(1),function(i){return xe(function(){return i})}(n))})}function Ia(e,t){t===void 0&&(t=ar);var n=function(r,i,o){r===void 0&&(r=0),o===void 0&&(o=Ql);var s=-1;return i!=null&&(Sa(i)?o=i:s=i),new me(function(a){var c=xa(r)?+r-o.now():r;c<0&&(c=0);var l=0;return o.schedule(function(){a.closed||(a.next(l++),0<=s?this.schedule(void 0,s):a.complete())},c)})}(e,t);return Ea(function(){return n})}function rf(e,t){return e===t}function ve(e,t){return fe(function(n,r){var i=0;n.subscribe(le(r,function(o){return e.call(t,o,i++)&&r.next(o)}))})}function To(e){return ve(function(t,n){return e<=n})}function of(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ka(e);return fe(function(r,i){(n?ci(e,r,n):ci(e,r)).subscribe(i)})}function se(e,t){return fe(function(n,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};n.subscribe(le(r,function(c){i?.unsubscribe();var l=0,u=o++;Je(e(c,u)).subscribe(i=le(r,function(d){return r.next(t?t(c,d,u,l++):d)},function(){i=null,a()}))},function(){s=!0,a()}))})}function Po(e,t,n){var r=X(e)||t||n?{next:e,error:t,complete:n}:e;return r?fe(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(le(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):sr}var sf=fa(function(e){return function(t){t===void 0&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function af(e){throw new sf(e)}let Do=!1;function qi(e,t){return R(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(t==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${e.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:e.name,purpose:t})}catch(n){Do||(console.debug("Dexie Cloud: Could not register sync event",n),Do=!0)}})}function We(e,t){e.cloud.usingServiceWorker?qi(e,t):e.localSyncEvent.next({purpose:t})}const Aa=typeof Buffer<"u"?e=>Buffer.from(e,"base64"):e=>{const t=atob(e),n=t.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=t.charCodeAt(i);return r},nn=typeof Buffer<"u"?e=>ArrayBuffer.isView(e)?Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"):Buffer.from(e).toString("base64"):e=>btoa(String.fromCharCode.apply(null,ArrayBuffer.isView(e)?e:new Uint8Array(e)));function ur(e,t){return new Promise((n,r)=>{const i=Object.assign(Object.assign({},t),{onSubmit:o=>{e.next(void 0),n(o)},onCancel:()=>{e.next(void 0),r(new q.AbortError("User cancelled"))}});e.next(i)})}function li(e,t,...n){return ur(e,{type:"message-alert",title:t,alerts:n,fields:{}})}function Ro(e,t,n){return R(this,void 0,void 0,function*(){let r=n||"";for(;!r||!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,10}$/.test(r);)r=(yield ur(e,{type:"email",title:t,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return r})}function jo(e,t,n){return R(this,void 0,void 0,function*(){const r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:t}}];n&&r.push(n);const{otp:i}=yield ur(e,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return i})}function uf(e,t,n,r,i){return R(this,void 0,void 0,function*(){return t.accessToken&&t.accessTokenExpiration.getTime()>Date.now()?t:t.refreshToken&&(!t.refreshTokenExpiration||t.refreshTokenExpiration.getTime()>Date.now())?yield cr(e,t):yield function(o,s,a,c){return R(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:l,publicKey:u}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!l||!u)throw new Error("Could not generate RSA keypair");o.nonExportablePrivateKey=l;const d=function(f){const h=nn(f);return function(p){let v=`-----BEGIN PUBLIC KEY-----
`;for(;p.length>0;)v+=p.substring(0,64)+`
`,p=p.substring(64);return v+="-----END PUBLIC KEY-----",v}(h)}(yield crypto.subtle.exportKey("spki",u));o.publicKey=u;try{const f=yield s({public_key:d,hints:c});if(f.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${f.type}`);return o.accessToken=f.accessToken,o.accessTokenExpiration=new Date(f.accessTokenExpiration),o.refreshToken=f.refreshToken,f.refreshTokenExpiration&&(o.refreshTokenExpiration=new Date(f.refreshTokenExpiration)),o.userId=f.claims.sub,o.email=f.claims.email,o.name=f.claims.name,o.claims=f.claims,f.alerts&&f.alerts.length>0&&(yield ur(a,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:f.alerts})),o}catch(f){throw yield li(a,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:"We're having a problem authenticating right now.",messageParams:{}}).catch(()=>{}),f}})}(t,n,r,i)})}function cr(e,t){return R(this,void 0,void 0,function*(){if(!t.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!t.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder().encode(t.refreshToken+n),o=yield crypto.subtle.sign(r,t.nonExportablePrivateKey,i),s=nn(o),a={grant_type:"refresh_token",refresh_token:t.refreshToken,scopes:["ACCESS_DB"],signature:s,signing_algorithm:r,time_stamp:n},c=yield fetch(`${e}/token`,{body:JSON.stringify(a),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(c.status!==200)throw new Error(`RefreshToken: Status ${c.status} from ${e}/token`);const l=yield c.json();return t.accessToken=l.accessToken,t.accessTokenExpiration=l.accessTokenExpiration?new Date(l.accessTokenExpiration):void 0,t})}const Ko=new WeakMap;class Yi{constructor(t,n){Ko.set(this,t),Object.assign(this,n)}static load(t,n){return t.table("$logins").get(n).then(r=>new Yi(t,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return R(this,void 0,void 0,function*(){Ko.get(this).table("$logins").put(this)})}}class fi extends Error{constructor(t,n){super(n||`${t.status} ${t.statusText}`),this.httpStatus=t.status}get name(){return"HttpError"}}function Bo(e,t){return R(this,void 0,void 0,function*(){if((yield e.getCurrentUser()).isLoggedIn){if(t){if(t.email&&e.cloud.currentUser.value.email!==t.email)throw new Error("Must logout before changing user");if(t.userId&&e.cloud.currentUserId!==t.userId)throw new Error("Must logout before changing user")}return!1}const n=new Yi(e,{claims:{},lastLogin:new Date(0)});yield uf(e.cloud.options.databaseUrl,n,e.cloud.options.fetchTokens||function(r){const{userInteraction:i}=r.cloud;return function({public_key:o,hints:s}){var a;return R(this,void 0,void 0,function*(){let c;const l=(a=r.cloud.options)===null||a===void 0?void 0:a.databaseUrl;if(!l)throw new Error("No database URL given.");c=s?.grant_type==="demo"?{demo_user:yield Ro(i,"Enter a demo user email",s?.email||s?.userId),grant_type:"demo",scopes:["ACCESS_DB"],public_key:o}:{email:yield Ro(i,"Enter email address",s?.email),grant_type:"otp",scopes:["ACCESS_DB"],public_key:o};const u=yield fetch(`${l}/token`,{body:JSON.stringify(c),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(u.status!==200){const f=yield u.text();throw yield li(i,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:f,messageParams:{}}).catch(()=>{}),new fi(u,f)}const d=yield u.json();if(d.type==="tokens")return d;if(c.grant_type==="otp"){if(d.type!=="otp-sent")throw new Error(`Unexpected response from ${l}/token`);const f=yield jo(i,c.email);c.otp=f||"",c.otp_id=d.otp_id;let h=yield fetch(`${l}/token`,{body:JSON.stringify(c),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;h.status===401;){const p=yield h.text();c.otp=yield jo(i,c.email,{type:"error",messageCode:"INVALID_OTP",message:p,messageParams:{}}),h=yield fetch(`${l}/token`,{body:JSON.stringify(c),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(h.status!==200){const p=yield h.text();throw yield li(i,"OTP Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:p,messageParams:{}}).catch(()=>{}),new fi(h,p)}return yield h.json()}throw new Error(`Unexpected response from ${l}/token`)})}}(e),e.cloud.userInteraction,t);try{yield n.save()}catch(r){try{r.name==="DataCloneError"&&(console.debug("Login context property names:",Object.keys(n)),console.debug("Login context:",n),console.debug("Login context JSON:",JSON.stringify(n)))}catch{}throw r}return yield function(r,i){return R(this,void 0,void 0,function*(){if(i.userId===r.cloud.currentUserId)return;const o=r.table("$logins");yield r.transaction("rw",o,s=>R(this,void 0,void 0,function*(){const a=yield o.toArray();yield Promise.all(a.filter(c=>c.userId!==i.userId&&c.isLoggedIn).map(c=>(c.isLoggedIn=!1,o.put(c)))),i.isLoggedIn=!0,i.lastLogin=new Date,yield i.save(),console.debug("Saved new user",i.email)})),yield new Promise(s=>{if(r.cloud.currentUserId===i.userId)s(null);else{const a=r.cloud.currentUser.subscribe(c=>{c.userId===i.userId&&(a.unsubscribe(),s(null))})}})})}(e,n),We(e,"pull"),!0})}const be={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(be),Object.freeze(be.claims)}catch{}const di={},Rt=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;Rt&&Rt.ready.then(e=>di.registration=e),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",e=>{var t,n;!((n=(t=e.data)===null||t===void 0?void 0:t.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>{var i;return r.id!==((i=e.source)===null||i===void 0?void 0:i.id)&&r.postMessage(e.data)})});class Er{constructor(t){this.name=t}subscribe(t){if(!Rt)return()=>{};const n=r=>{var i;((i=r.data)===null||i===void 0?void 0:i.type)===`sw-broadcast-${this.name}`&&t(r.data.message)};return Rt.addEventListener("message",n),()=>Rt.removeEventListener("message",n)}postMessage(t){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:`sw-broadcast-${this.name}`,message:t})):di.registration&&((n=di.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:t}))}}const Et=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class yn extends ee{constructor(t){const n=typeof BroadcastChannel>"u"?new Er(t):new BroadcastChannel(t);super(r=>{function i(a){r.next(a.detail)}function o(a){console.debug("BroadcastedAndLocalEvent: onMessageEvent",a),r.next(a.data)}let s;(function(a,c){Et.has(a)?Et.get(a).push(c):Et.set(a,[c])})(`lbc-${t}`,i);try{n instanceof Er?s=n.subscribe(a=>r.next(a)):(console.debug("BroadcastedAndLocalEvent: bc.addEventListener()",t,"bc is a",n),n.addEventListener("message",o))}catch(a){console.warn("Failed to subscribe to broadcast channel",a)}return()=>{(function(a,c){const l=Et.get(a);if(l){const u=l.indexOf(c);u!==-1&&l.splice(u,1)}})(`lbc-${t}`,i),n instanceof Er?s():n.removeEventListener("message",o)}}),this.name=t,this.bc=n}next(t){console.debug("BroadcastedAndLocalEvent: bc.postMessage()",Object.assign({},t),"bc is a",this.bc),this.bc.postMessage(t),function(n){const r=Et.get(n.type);r&&r.forEach(i=>{try{i(n)}catch{}})}(new CustomEvent(`lbc-${this.name}`,{detail:t}))}}function hi({realms:e,inviteRealms:t}){return R(this,void 0,void 0,function*(){const n=JSON.stringify([...e.map(o=>({realmId:o,accepted:!0})),...t.map(o=>({realmId:o,accepted:!1}))].sort((o,s)=>o.realmId<s.realmId?-1:o.realmId>s.realmId?1:0)),r=new TextEncoder().encode(n),i=yield crypto.subtle.digest("SHA-1",r);return nn(i)})}function Tn(e){return Object.entries(e.cloud.schema||{}).filter(([,{markedForSync:t}])=>t).map(([t])=>e.tables.filter(({name:n})=>n===t)[0]).filter(t=>t)}function Gi(e){return`$${e}_mutations`}function Oa(e){var t;const n=(t=/^\$(.*)_mutations$/.exec(e))===null||t===void 0?void 0:t[1];if(!n)throw new Error(`Given mutationTable ${e} is not correct`);return n}const cf=[].concat;function Ca(e){return cf.apply([],e)}function pi(e,t,{since:n={},limit:r=1/0}={}){return R(this,void 0,void 0,function*(){const i=Ca(yield Promise.all(e.map(c=>R(this,void 0,void 0,function*(){const l=Oa(c.name),u=n[l];let d=u?c.where("rev").above(u):c;return r<1/0&&(d=d.limit(r)),(yield d.toArray()).map(f=>({table:l,mut:f}))})))).sort((c,l)=>c.mut.ts-l.mut.ts),o=[];let s=null,a=null;for(const{table:c,mut:l}of i)s&&s.table===c&&a===l.txid?s.muts.push(l):(s={table:c,muts:[l]},a=l.txid,o.push(s));return o})}function Ji(e){const t=new Uint8Array(e);if(typeof crypto<"u")crypto.getRandomValues(t);else for(let n=0;n<e;n++)t[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(t).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,t));throw new Error("No btoa or Buffer available")}const{toString:lf}={},Mo={replace:function(e){const t=Object.keys(e);let n=null;for(let i=0,o=t.length;i<o;++i)t[i][0]==="$"&&(n=n||[],n.push(t[i]));if(!n)return e;const r={...e};for(const i of n)delete r[i];for(const i of n)r["$"+i]=e[i];return r}};function Ta(...e){const t=e.reduce((r,i)=>({...r,...i}),e.reduce((r,i)=>({...i,...r}),{})),n=new WeakMap;return{stringify(r,i,o){return JSON.stringify(r,function(a){const c=this[a],l=function(u){const d=typeof u;switch(typeof u){case"object":case"function":{if(u===null)return null;const h=Object.getPrototypeOf(u);if(!h)return Mo;let p=n.get(h);if(p!==void 0)return p;const v=(f=u,lf.call(f).slice(8,-1)),m=Object.entries(t).find(([b,w])=>{var y,g;return(g=(y=w?.test)===null||y===void 0?void 0:y.call(w,u,v))!==null&&g!==void 0?g:b===v});return p=m?.[1],p||(p=Array.isArray(u)?null:typeof u=="function"?t.function||null:Mo),n.set(h,p),p}default:return t[d]}var f}(c);return l?l.replace(c,i,t):c},o)},parse(r,i){const o=[];return JSON.parse(r,function(s,a){const c=a?.$t;if(c){const u=t[c];a=u?u.revive(a,i,t):a}let l=o[o.length-1];if(l&&l[0]===a){a={...a};for(const u of l[1])delete a[u];for(const[u,d]of Object.entries(l[2]))a[u]=d;o.pop()}if(a===void 0||s[0]==="$"&&s!=="$t"){let u,d;l=o[o.length-1],l&&l[0]===this?(u=l[1],d=l[2]):o.push([this,u=[],d={}]),s[0]==="$"&&s!=="$t"?(u.push(s),d[s.substr(1)]=a):d[s]=void 0}return a})}}}const ff={Blob:{test:(e,t)=>t==="Blob",replace:(e,t)=>{const n=t.length;return t.push(e),{$t:"Blob",mimeType:e.type,i:n}},revive:({i:e,mimeType:t},n)=>new Blob([n[e]],{type:t})}};var df={number:{replace:e=>{switch(!0){case isNaN(e):return{$t:"number",v:"NaN"};case e===1/0:return{$t:"number",v:"Infinity"};case e===-1/0:return{$t:"number",v:"-Infinity"};default:return e}},revive:({v:e})=>Number(e)}};const hf={bigint:{replace:e=>({$t:"bigint",v:""+e}),revive:e=>BigInt(e.v)}};var pf={Date:{replace:e=>({$t:"Date",v:isNaN(e.getTime())?"NaN":e.toISOString()}),revive:({v:e})=>new Date(e==="NaN"?NaN:Date.parse(e))}},vf={Set:{replace:e=>({$t:"Set",v:Array.from(e.entries())}),revive:({v:e})=>new Set(e)}},yf={Map:{replace:e=>({$t:"Map",v:Array.from(e.entries())}),revive:({v:e})=>new Map(e)}};const mf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global>"u"?global:void 0;var bf=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((e,t)=>({...e,[t]:{replace:(n,r,i)=>({$t:t,v:i.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r,i).v}),revive:({v:n},r,i)=>{const o=mf[t];return o&&new o(i.ArrayBuffer.revive({v:n},r,i))}}}),{});function Pa(e){return function(t){for(var n="",r=0,i=t.length;r<i;r++)n+=Da[t[r]];return n}(nn(e))}function gf(e){return Aa(function(t){if(typeof t!="string")throw new Error("invalid decoder input: "+t);for(var n="",r=0,i=t.length;r<i;r++)n+=vi[t[r]];return n}(e))}const vi={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Da={};for(const e of Object.keys(vi))Da[vi[e]]=e;var wf={ArrayBuffer:{replace:e=>({$t:"ArrayBuffer",v:Pa(e)}),revive:({v:e})=>{const t=gf(e);return t.buffer.byteLength===t.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}}};class Ir{constructor(t,n){this.buf=t,this.type=n}}function _f(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",URL.createObjectURL(e),!1),t.send(),t.status!==200&&t.status!==0)throw new Error("Bad Blob access: "+t.status);return t.responseText}function Sf(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}var xf={Blob:{test:(e,t)=>t==="Blob"||e instanceof Ir,replace:e=>({$t:"Blob",v:nn(e instanceof Ir?e.buf:Sf(_f(e))),type:e.type}),revive:({type:e,v:t})=>{const n=Aa(t);return typeof Blob!==void 0?new Blob([n]):new Ir(n.buffer,e)}}};const Ra={...df,...hf,...pf,...vf,...yf,...bf,...wf,...xf};function Uo(e){return new Promise((t,n)=>{const r=new FileReader;r.onabort=i=>n(new Error("file read aborted")),r.onerror=i=>n(i.target.error),r.onload=i=>t(i.target.result),r.readAsArrayBuffer(e)})}var kf={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}};const Ef=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class Lo{toString(){return this.v}constructor(t){this.v=t}}const ja=Object.assign(Object.assign({},kf),Ef?{}:{bigint:{test:e=>e instanceof Lo,replace:e=>Object.assign({$t:"bigint"},e),revive:({v:e})=>new Lo(e)}}),Gn=Ta(Ra,ja),If=function(...e){const t=Ta(Ra,ff,...e);return{toBinary(n){const[r,i]=this.stringify(n),o=new ArrayBuffer(4);return new DataView(o).setUint32(0,r.size),new Blob([o,r,i])},stringify(n){const r=[],i=t.stringify(n,r);return[new Blob(r.map(s=>{const a=new ArrayBuffer(4);return new DataView(a).setUint32(0,"byteLength"in s?s.byteLength:s.size),new Blob([a,s])})),i]},async parse(n,r){let i=0;const o=[],s=await Uo(r),a=new DataView(s);for(;i<s.byteLength;){const c=a.getUint32(i);i+=4;const l=s.slice(i,i+c);i+=c,o.push(l)}return t.parse(n,o)},async fromBinary(n){const r=new DataView(await Uo(n.slice(0,4))).getUint32(0),i=n.slice(4,r+4),o=await function(s){return new Promise((a,c)=>{const l=new FileReader;l.onabort=u=>c(new Error("file read aborted")),l.onerror=u=>c(u.target.error),l.onload=u=>a(u.target.result),l.readAsText(s)})}(n.slice(r+4));return await this.parse(o,i)}}}(ja);function Af(e,t,n){const r=[];for(let i of n){const{table:o,muts:s}=i,a=e.tables.find(u=>u.name===o);if(!a)throw new Error(`Internal error: table ${o} not found in DBCore schema`);const{primaryKey:c}=a;let l=i;s.forEach((u,d)=>{const f=!c.outbound&&(u.type==="upsert"||u.type==="insert");u.keys.forEach((h,p)=>{if(Array.isArray(h)){l===i&&(l=Fo(i,f));const v=l.muts[d],m=JSON.stringify(h);v.keys[p]=m,f&&q.setByKeyPath(v.values[p],c.keyPath,m)}else if(h[0]==="#"){l===i&&(l=Fo(i,f));const v=l.muts[d];if(!t.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const m=`${h}:${t.userId}`;v.keys[p]=m,f&&q.setByKeyPath(v.values[p],c.keyPath,m)}})}),r.push(l)}return r}function Fo(e,t){return Object.assign(Object.assign({},e),{muts:t?e.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):e.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}function Of(e,t,n,r,i,o,s,a){return R(this,void 0,void 0,function*(){const c={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},l=yield function(f){var h,p;return R(this,void 0,void 0,function*(){const v=yield f.getCurrentUser(),{accessToken:m,accessTokenExpiration:b,refreshToken:w,refreshTokenExpiration:y,claims:g}=v;if(!m)return;if(((h=b?.getTime())!==null&&h!==void 0?h:1/0)>Date.now())return m;if(!w)throw new Error("Refresh token missing");if(((p=y?.getTime())!==null&&p!==void 0?p:1/0)<=Date.now())throw new Error("Refresh token has expired");const _=yield cr(f.cloud.options.databaseUrl,v);return yield f.table("$logins").update(g.sub,{accessToken:_.accessToken,accessTokenExpiration:_.accessTokenExpiration}),_.accessToken})}(r);l&&(c.Authorization=`Bearer ${l}`);const u={v:2,dbID:t?.remoteDbId,clientIdentity:s,schema:o||{},lastPull:t?{serverRevision:t.serverRevision,realms:t.realms,inviteRealms:t.inviteRealms}:void 0,baseRevs:n,changes:Af(r.dx.core.schema,a,e)};console.debug("Sync request",u),r.syncStateChangedEvent.next({phase:"pushing"});const d=yield fetch(`${i}/sync`,{method:"post",headers:c,body:Gn.stringify(u)});if(r.syncStateChangedEvent.next({phase:"pulling"}),!d.ok)throw new fi(d);if(d.headers.get("content-type")==="application/x-bison")return If.fromBinary(yield d.blob());{const f=yield d.text();return Gn.parse(f)}})}function It(e){if(e?.cancelled)throw new q.AbortError("Operation was cancelled")}let nt=!1;function Ka(e,t,n,r){return R(this,void 0,void 0,function*(){yield e.$baseRevs.bulkPut(Object.keys(t).filter(i=>t[i].markedForSync).map(i=>({tableName:i,clientRev:(n[i]||0)+1,serverRev:r})))})}function yi(e,t={}){for(const{table:n,muts:r}of e){const i=r.length>0?r[r.length-1].rev:null;t[n]=i||t[n]||0}return t}function Cf(e,t,n){return R(this,void 0,void 0,function*(){const r=yield e.bulkGet(t),i=[],o=[];t.forEach((s,a)=>{const c=r[a];if(c){for(const[l,u]of Object.entries(n[a]))if(l===e.schema.primKey.keyPath){if(Y(u,s)!==0)throw new Error("Cannot change primary key")}else q.setByKeyPath(c,l,u);i.push(s),o.push(c)}}),yield e.schema.primKey.keyPath==null?e.bulkPut(o,i):e.bulkPut(o)})}function Ba(e,t){return R(this,void 0,void 0,function*(){console.debug("Applying server changes",e,q.currentTransaction);for(const{table:n,muts:r}of e){const i=t.table(n);if(!i)continue;const{primaryKey:o}=i.core.schema,s=a=>{switch(a[0]){case"[":if(a.endsWith("]"))try{return JSON.parse(a)}catch{}return a;case"#":return a.endsWith(":"+t.cloud.currentUserId)?a.substr(0,a.length-t.cloud.currentUserId.length-1):a;default:return a}};for(const a of r){const c=a.keys.map(s);switch(a.type){case"insert":o.outbound?yield i.bulkAdd(a.values,c):(c.forEach((l,u)=>{q.setByKeyPath(a.values[u],o.keyPath,l)}),yield i.bulkAdd(a.values));break;case"upsert":o.outbound?yield i.bulkPut(a.values,c):(c.forEach((l,u)=>{q.setByKeyPath(a.values[u],o.keyPath,l)}),yield i.bulkPut(a.values));break;case"modify":c.length===1?yield i.update(c[0],a.changeSpec):yield i.where(":id").anyOf(c).modify(a.changeSpec);break;case"update":yield Cf(i,c,a.changeSpecs);break;case"delete":yield i.bulkDelete(c)}}}})}typeof self<"u"&&typeof navigator<"u"&&(nt=navigator.onLine,self.addEventListener("online",()=>nt=!0),self.addEventListener("offline",()=>nt=!1));function qt(e,t,n,r){return Ma.apply(this,arguments).then(()=>{r?.justCheckIfNeeded||e.syncStateChangedEvent.next({phase:"in-sync"})}).catch(i=>R(this,void 0,void 0,function*(){return r?.justCheckIfNeeded?Promise.reject(i):(console.debug("Error from _sync",{isOnline:nt,syncOptions:r,error:i}),nt&&r?.retryImmediatelyOnFetchError&&i?.name==="TypeError"&&/fetch/.test(i?.message)?(e.syncStateChangedEvent.next({phase:"error",error:i}),yield new Promise(o=>setTimeout(o,500)),yield qt(e,t,n,Object.assign(Object.assign({},r),{retryImmediatelyOnFetchError:!1}))):(yield e.$syncState.update("syncState",{timestamp:new Date,error:""+i}),e.syncStateChangedEvent.next({phase:nt?"error":"offline",error:i}),Promise.reject(i)))}))}function Ma(e,t,n,{isInitialSync:r,cancelToken:i,justCheckIfNeeded:o,purpose:s}={isInitialSync:!1}){var a;return R(this,void 0,void 0,function*(){if(o||console.debug("SYNC STARTED",{isInitialSync:r,purpose:s}),!(!((a=e.cloud.options)===null||a===void 0)&&a.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:c}=t,l=yield e.getCurrentUser(),u=l.isLoggedIn?Tn(e):[],d=u.map(x=>e.table(Gi(x.name))),f=yield e.getPersistedSyncState(),h=!r&&l.isLoggedIn,p=h?function(x,I){const E=I?.syncedTables||[];return Tn(x).filter(A=>!E.includes(A.name))}(e,f):[];It(i);const v=p.length>0;if(v){if(o)return!0;yield e.transaction("rw",p,x=>R(this,void 0,void 0,function*(){x.idbtrans.disableChangeTracking=!0,x.idbtrans.disableAccessControl=!0,yield function(I,E,A){return R(this,void 0,void 0,function*(){const T=new Set(A||[]);for(const O of I)O.name==="members"?yield O.toCollection().modify(P=>{T.has(P.realmId)||P.userId&&P.userId!==be.userId||(P.userId=E.userId)}):O.name==="roles"||(O.name==="realms"?yield O.toCollection().modify(P=>{T.has(P.realmId)||P.owner!==void 0&&P.owner!==be.userId||(P.owner=E.userId)}):yield O.toCollection().modify(P=>{P.realmId&&T.has(P.realmId)||(P.owner&&P.owner!==be.userId||(P.owner=E.userId),P.realmId&&P.realmId!==be.userId||(P.realmId=E.userId))}))})}(p,l,f?.realms)})),It(i)}const[m,b,w]=yield e.transaction("r",e.tables,()=>R(this,void 0,void 0,function*(){const x=yield e.getPersistedSyncState(),I=yield e.$baseRevs.toArray();let E=yield pi(d);if(It(i),v){const A=[...f?.realms||[],...f?.inviteRealms||[]],T=yield function(O,P,D,U){return R(this,void 0,void 0,function*(){const H=`upload-${Ji(8)}`;if(P.isLoggedIn&&O.length>0){const ue=new Set(U||[]);return(yield Promise.all(O.map(V=>R(this,void 0,void 0,function*(){const{extractKey:G}=V.core.schema.primaryKey;if(!G)return{table:V.name,muts:[]};const re=D[V.name],z=re?.generatedGlobalId?V.filter(N=>{return G(N),!ue.has(N.realmId||"")&&(te=G(N),!(sn=re?.idPrefix)||typeof te=="string"&&te.startsWith(sn));var te,sn}):V.filter(N=>{const te=G(N);return!ue.has(N.realmId||"")&&Wi(te)}),ce=yield z.toArray();if(ce.length>0){const N={type:"upsert",values:ce,keys:ce.map(G),userId:P.userId,txid:H};return{table:V.name,muts:[N]}}return{table:V.name,muts:[]}})))).filter(V=>V.muts.length>0)}return[]})}(p,l,n,A);return It(i),E=E.concat(T),[E,x,I]}return[E,x,I]})),y=m.some(x=>x.muts.some(I=>I.keys.length>0));if(o)return console.debug("Sync is needed:",y),y;if(s==="push"&&!y)return!1;const g=yi(m,b?.latestRevisions),_=b?.clientIdentity||aa(16);It(i);const S=yield Of(m,b,w,e,c,n,_,l);return console.debug("Sync response",S),(yield e.transaction("rw",e.tables,x=>R(this,void 0,void 0,function*(){x.idbtrans.disableChangeTracking=!0,x.idbtrans.disableAccessControl=!0;for(const O of Object.keys(n))S.schema[O]&&(n[O]=S.schema[O]);yield e.$syncState.put(n,"schema");const I=yield pi(d,0,{since:g});for(const O of d){const P=Oa(O.name);if(I.some(D=>D.table===P&&D.muts.length>0)){if(g[P]){const D=g[P]||0;yield Promise.all([O.where("rev").belowOrEqual(D).delete(),e.$baseRevs.where(":id").between([P,-1/0],[P,D+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([O.clear(),e.$baseRevs.where({tableName:P}).delete()])}yi(I,g),yield Ka(e,n,g,S.serverRevision);const E=yield e.getPersistedSyncState();yield function(O,P,D){return R(this,void 0,void 0,function*(){const U=new Set,H=new Set,ue=D?D.realms:[],V=D?D.inviteRealms:[],G=new Set(P.realms),re=new Set(P.realms.concat(P.inviteRealms));for(const z of ue)G.has(z)||(H.add(z),re.has(z)||U.add(z));for(const z of V.concat(ue))re.has(z)||U.add(z);if(U.size>0||H.size>0){const z=Tn(O);for(const ce of z){let N=["realms","members","roles"].includes(ce.name)?U:H;N.size!==0&&(ce.schema.indexes.some(te=>te.keyPath==="realmId"||Array.isArray(te.keyPath)&&te.keyPath[0]==="realmId")?yield ce.where("realmId").anyOf([...N]).delete():yield ce.filter(te=>!!te?.realmId&&N.has(te.realmId)).delete())}}})}(e,S,E);const A=E||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:_};h&&(A.syncedTables=u.map(O=>O.name).concat(p.map(O=>O.name))),A.latestRevisions=g,A.remoteDbId=S.dbId,A.initiallySynced=!0,A.realms=S.realms,A.inviteRealms=S.inviteRealms,A.serverRevision=S.serverRevision,A.timestamp=new Date,delete A.error;const T=Ua(S.changes,I);return yield Ba(T,e),e.$syncState.put(A,"syncState"),I.length===0})))?(console.debug("SYNC DONE",{isInitialSync:r}),e.syncCompleteEvent.next(),!1):(console.debug("MORE SYNC NEEDED. Go for it again!"),yield Ma(e,t,n,{isInitialSync:r,cancelToken:i}))})}function Ua(e,t){const n={};_o(n,e);const r={};return _o(r,t),function(i,o){var s,a,c;for(const[l,u]of Object.entries(o))for(const[d,f]of Object.entries(u))switch(f.type){case"ups":{const h=(s=i[l])===null||s===void 0?void 0:s[d];if(h)switch(h.type){case"ups":case"upd":delete i[l][d]}}break;case"del":(a=i[l])===null||a===void 0||delete a[d];break;case"upd":{const h=(c=i[l])===null||c===void 0?void 0:c[d];if(h)switch(h.type){case"ups":for(const[p,v]of Object.entries(f.mod))Yn(h.val,p,v);break;case"del":break;case"upd":for(const p of Object.keys(f.mod))delete h.mod[p]}break}}}(n,r),function(i,o=""){o||(o=aa(16));const s={};for(const[c,l]of Object.entries(i))for(const[u,d]of Object.entries(l)){const f=s[c]||(s[c]={});(f[d.type]||(f[d.type]=[])).push(Object.assign({key:u},d))}const a=[];for(const[c,l]of Object.entries(s)){const u={table:c,muts:[]};for(const[d,f]of Object.entries(l))switch(d){case"ups":{const h={type:"upsert",keys:f.map(p=>p.key),values:f.map(p=>p.val),txid:o};u.muts.push(h);break}case"upd":{const h={type:"update",keys:f.map(p=>p.key),changeSpecs:f.map(p=>p.mod),txid:o};u.muts.push(h);break}case"del":{const h={type:"delete",keys:f.map(p=>p.key),txid:o};u.muts.push(h);break}}a.push(u)}return a}(n)}function Tf(e){const t=[],n=new ye(!0),r=new ye(null);let i=!1,o=0,s=[0,0,0,0,0,0,0,0,0,Date.now()];return r.subscribe(()=>R(this,void 0,void 0,function*(){if(!i&&t.length>0){i=!0,s.shift(),s.push(Date.now()),n.next(!1);try{yield function(){var a,c,l,u,d,f;return R(this,void 0,void 0,function*(){for(;t.length>0;){const h=t.shift();try{yield e.cloud.syncState.pipe(ve(({phase:v})=>v==="in-sync"||v==="error"),_e(1)).toPromise(),console.debug("processing msg",h);const p=e.cloud.persistedSyncState.value;if(!h)continue;switch(h.type){case"token-expired":console.debug("WebSocket observable: Token expired. Refreshing token...");const v=e.cloud.currentUser.value,m=yield cr(e.cloud.options.databaseUrl,v);yield e.table("$logins").update(v.userId,{accessToken:m.accessToken,accessTokenExpiration:m.accessTokenExpiration});break;case"realm-added":((a=p?.realms)===null||a===void 0?void 0:a.includes(h.realm))||((c=p?.inviteRealms)===null||c===void 0?void 0:c.includes(h.realm))||(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((l=p?.realms)===null||l===void 0)&&l.includes(h.realm)||(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(((u=p?.realms)===null||u===void 0?void 0:u.includes(h.realm))||((d=p?.inviteRealms)===null||d===void 0?void 0:d.includes(h.realm)))&&(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield e.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(console.debug("changes"),((f=e.cloud.syncState.value)===null||f===void 0?void 0:f.phase)==="error"){We(e,"pull");break}yield e.transaction("rw",e.dx.tables,b=>R(this,void 0,void 0,function*(){b.idbtrans.disableChangeTracking=!0,b.idbtrans.disableAccessControl=!0;const[w,y,g]=yield Promise.all([e.getSchema(),e.getPersistedSyncState(),e.getCurrentUser()]);if(console.debug("ws message queue: in transaction"),!y||!w||!g)return void console.debug("required vars not present",{syncState:y,schema:w,currentUser:g});if(h.baseRev!==y.serverRevision)return console.debug(`baseRev (${h.baseRev}) differs from our serverRevision in syncState (${y.serverRevision})`),void(typeof h.baseRev!="string"||typeof y.serverRevision!="bigint"&&typeof y.serverRevision!="object"||We(e,"pull"));const _=yield q.waitFor(hi(y));if(console.debug("ourRealmSetHash",_),_!==h.realmSetHash)return console.debug("not same realmSetHash",h.realmSetHash),void We(e,"pull");let S=[];if(g.isLoggedIn){const k=Tn(e).map(x=>e.table(Gi(x.name)));S=yield pi(k),console.debug("msg queue: client changes",S)}if(h.changes.length>0){const k=Ua(h.changes,S);console.debug("applying filtered server changes",k),yield Ba(k,e)}y.latestRevisions=yi(S,y.latestRevisions),y.serverRevision=h.newRev,console.debug("Updating baseRefs",y.latestRevisions),yield Ka(e,w,y.latestRevisions,h.newRev),console.debug("Updating syncState",y),yield e.$syncState.put(y,"syncState")})),console.debug("msg queue: done with rw transaction")}}catch(p){console.error("Error in msg queue",p)}}})}()}finally{s[s.length-1]-s[0]<1e4&&(Date.now()-o<5e3?(console.warn("Slowing down websocket loop for one minute"),o=Date.now()+6e4,yield new Promise(a=>setTimeout(a,6e4))):(console.warn("Slowing down websocket loop for 10 seconds"),o=Date.now()+1e4,yield new Promise(a=>setTimeout(a,1e4)))),i=!1,n.next(!0)}}})),{enqueue:function(a){t.push(a),r.next(null)},readyToServe:n}}const $o=new WeakMap,mn={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let Pf=0;function Xe(e){"vip"in e&&(e=e.vip);let t=$o.get(e.cloud);if(!t){const n=new Gt;let r=new yn(`syncstatechanged-${e.name}`),i=new yn(`synccomplete-${e.name}`);n.id=++Pf;let o=!1;t={get name(){return e.name},close:()=>e.close(),transaction:e.transaction.bind(e),table:e.table.bind(e),get tables(){return e.tables},cloud:e.cloud,get $jobs(){return e.table("$jobs")},get $syncState(){return e.table("$syncState")},get $baseRevs(){return e.table("$baseRevs")},get $logins(){return e.table("$logins")},get realms(){return e.realms},get members(){return e.members},get roles(){return e.roles},get initiallySynced(){return o},localSyncEvent:n,get syncStateChangedEvent(){return r},get syncCompleteEvent(){return i},dx:e},Object.assign(t,{getCurrentUser:()=>t.$logins.toArray().then(a=>a.find(c=>c.isLoggedIn)||be),getPersistedSyncState:()=>t.$syncState.get("syncState"),getSchema:()=>t.$syncState.get("schema").then(a=>{if(a)for(const l of t.tables)l.schema.primKey&&l.schema.primKey.keyPath&&a[l.name]&&(a[l.name].primaryKey=typeof(c=l.schema.primKey.keyPath)=="string"?c:c?"["+[].join.call(c,"+")+"]":"");var c;return a}),getOptions:()=>t.$syncState.get("options"),setInitiallySynced(a){o=a},reconfigure(){r=new yn(`syncstatechanged-${e.name}`),i=new yn(`synccomplete-${e.name}`)}}),t.messageConsumer=Tf(t),$o.set(e.cloud,t)}return t}const Df=typeof InstallTrigger<"u",La=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),Rf=La?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,No=La&&Rf<=605||Df,jf=typeof self<"u"&&"clients"in self&&!self.document;function Fa(){throw new q.SchemaError("Version increment needed to allow dexie-cloud change tracking")}const{toString:Kf}={};function Wo(e){return Kf.call(e).slice(8,-1)}function Ar(e,t){var n;return t.type==="delete"?t.keys:((n=t.keys)===null||n===void 0?void 0:n.slice())||t.values.map(e.extractKey)}const Bf=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;let Ae=0;function $a(e,t){const n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();Ae>=i?++Ae:Ae=i,r[0]=Ae/1099511627776,r[1]=Ae/4294967296,r[2]=Ae/16777216,r[3]=Ae/65536,r[4]=Ae/256,r[5]=Ae;const o=new Uint8Array(n.buffer,6);return crypto.getRandomValues(o),e+Pa(new Uint8Array(n.buffer))+(t||"")}function Mf(e){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:t=>Object.assign(Object.assign({},t),{table:n=>{const r=t.table(n);return Object.assign(Object.assign({},r),{mutate:i=>{var o,s;if(i.trans.disableChangeTracking)return r.mutate(i);if(i.type==="add"||i.type==="put"){const a=(o=e.cloud.schema)===null||o===void 0?void 0:o[n];if(a?.generatedGlobalId){if(((s=e.cloud.options)===null||s===void 0?void 0:s.databaseUrl)&&!e.initiallySynced){const c=Ar(r.schema.primaryKey,i);return r.getMany({keys:c,trans:i.trans,cache:"immutable"}).then(l=>{if(l.length<c.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(i)})}return function(c,l){let u=null;const d=Ar(r.schema.primaryKey,c);return d.forEach((f,h)=>{if(f===void 0){const p=c.values[h].realmId||e.cloud.currentUserId,v=p.substr(p.length-3);d[h]=$a(l,v),r.schema.primaryKey.outbound||(u||(u=c.values.slice()),u[h]=q.deepClone(u[h]),q.setByKeyPath(u[h],r.schema.primaryKey.keyPath,d[h]))}else if(typeof f!="string"||!f.startsWith(l)&&!f.startsWith("#"+l))throw new q.ConstraintError(`The ID "${f}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${l}" (or "#${l}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),r.mutate(Object.assign(Object.assign({},c),{keys:d,values:u||c.values}))}(i,a.idPrefix)}a?.markedForSync&&Ar(r.schema.primaryKey,i).forEach((c,l)=>{if(!Wi(c)){const u=Array.isArray(c)?c.map(Wo).join(","):Wo(c);throw new q.ConstraintError(`Invalid primary key type ${u} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return r.mutate(i)}})}})}}let Uf=0;function At(e,t){return function(n){const{readers:r,writers:i}=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),o=i.length,s=(o>0?i[o-1].then(()=>e(n),()=>e(n)):e(n)).finally(()=>r.splice(r.indexOf(s)));return r.push(s),s}}function Lf(e,t){return function(n){const{readers:r,writers:i}=n.trans[t]||(n.trans[t]={writers:[],readers:[]});let o=(i.length>0?i[i.length-1].then(()=>e(n),()=>e(n)):r.length>0?(s=r,new Promise(a=>{s.length===0&&a([]);let c=s.length;const l=new Array(c);s.forEach((u,d)=>Promise.resolve(u).then(f=>l[d]={status:"fulfilled",value:f},f=>l[d]={status:"rejected",reason:f}).then(()=>--c||a(l)))})).then(()=>e(n)):e(n)).finally(()=>i.shift());var s;return i.push(o),o}}const ut=new ye(new Set);function Ff({currentUserObservable:e,db:t}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const r=n.schema.tables.filter(o=>!/^\$/.test(o.name));let i;try{i=new Map(r.map(o=>[o.name,n.table(`$${o.name}_mutations`)]))}catch{Fa()}return Object.assign(Object.assign({},n),{transaction:(o,s)=>{let a;if(s==="readwrite"){const c=o.filter(l=>{var u,d;return(d=(u=t.cloud.schema)===null||u===void 0?void 0:u[l])===null||d===void 0?void 0:d.markedForSync}).map(l=>Gi(l));a=n.transaction([...o,...c],s)}else a=n.transaction(o,s);if(s==="readwrite"){a.txid=Ji(16),a.currentUser=e.value,ut.value.add(a),ut.next(ut.value);const c=()=>{a.removeEventListener("complete",l),a.removeEventListener("error",c),a.removeEventListener("abort",c),ut.value.delete(a),ut.next(ut.value)},l=()=>{var u;a.mutationsAdded&&((u=t.cloud.options)===null||u===void 0?void 0:u.databaseUrl)&&(t.cloud.usingServiceWorker?(console.debug("registering sync event"),qi(t,"push")):t.localSyncEvent.next({purpose:"push"})),c()};a.addEventListener("complete",l),a.addEventListener("error",c),a.addEventListener("abort",c)}return a},table:o=>{const s=n.table(o);if(/^\$/.test(o))return o.endsWith("_mutations")?Object.assign(Object.assign({},s),{mutate:u=>(u.type!=="add"&&u.type!=="put"||(u.trans.mutationsAdded=!0),s.mutate(u))}):o==="$logins"?Object.assign(Object.assign({},s),{mutate:u=>s.mutate(u).then(d=>(u.trans.mutationsAdded=!0,d)).catch(d=>(console.debug("Failed mutation $logins",d),Promise.reject(d)))}):s;const{schema:a}=s,c=i.get(o);return function(u){const d="$lock"+ ++Uf;return Object.assign(Object.assign({},u),{count:At(u.count,d),get:At(u.get,d),getMany:At(u.getMany,d),openCursor:At(u.openCursor,d),query:At(u.query,d),mutate:Lf(u.mutate,d)})}(Object.assign(Object.assign({},s),{mutate:u=>{var d,f,h;const p=u.trans;return p.txid?p.disableChangeTracking?s.mutate(u):((f=(d=t.cloud.schema)===null||d===void 0?void 0:d[o])===null||f===void 0?void 0:f.markedForSync)&&((h=p.currentUser)===null||h===void 0?void 0:h.isLoggedIn)?u.type==="deleteRange"?s.query({query:{range:u.range,index:a.primaryKey},trans:u.trans,values:!1}).then(v=>l({type:"delete",keys:v.result,trans:u.trans,criteria:{index:null,range:u.range}})):l(u):s.mutate(u):s.mutate(u)}}));function l(u){const d=u.trans;d.mutationsAdded=!0;const{txid:f,currentUser:{userId:h}}=d,{type:p}=u;return s.mutate(u).then(v=>{const{numFailures:m,failures:b}=v;let w=p==="delete"?u.keys:v.results,y="values"in u?u.values:[],g="updates"in u&&u.updates;m&&(w=w.filter((k,x)=>!b[x]),y=y.filter((k,x)=>!b[x]));const _=Date.now(),S=u.type==="delete"?{type:"delete",ts:_,keys:w,criteria:u.criteria,txid:f,userId:h}:u.type==="add"?{type:"insert",ts:_,keys:w,txid:f,userId:h,values:y}:u.criteria&&u.changeSpec?{type:"modify",ts:_,keys:w,criteria:u.criteria,changeSpec:u.changeSpec,txid:f,userId:h}:g?{type:"update",ts:_,keys:g.keys,changeSpecs:g.changeSpecs,txid:f,userId:h}:{type:"upsert",ts:_,keys:w,values:y,txid:f,userId:h};return w.length>0||"criteria"in u&&u.criteria?c.mutate({type:"add",trans:d,values:[S]}).then(()=>v):v})}}})}}}function $f(e,t){return function(n,r){const i=Object.assign(Object.assign({},mn),n);Object.keys(mn).forEach(a=>{const c=i[a];if(c==null)throw new Error(`Cannot delete table ${a} as it is needed for access control of Dexie Cloud`);if(!n[a])return;const l=c.split(",").map(f=>f.trim()),u=mn[a].split(",").map(f=>f.trim()),d=new Set(l.map(f=>f.replace(/([&*]|\+\+)/g,"")));if(l[0]!==u[0])throw new Error(`Cannot override primary key of table ${a}. Please declare it as {${a}: ${JSON.stringify(mn[a])}`);for(let f=1;f<u.length;++f){const h=u[f];d.has(h.replace(/([&*]|\+\+)/g,""))||(i[a]+=`,${h}`)}});const o=t.cloud.schema||(t.cloud.schema={}),s=new Set;return Object.keys(i).forEach(a=>{const c=i[a],l=o[a]||(o[a]={});c!=null?(/^\@/.test(c)&&(i[a]=i[a].substr(1),l.generatedGlobalId=!0,l.idPrefix=function(u,d){let f=u[0].toLocaleLowerCase();for(let m=1,b=u.length;m<b&&f.length<3;++m)(Bf.test(u[m])||(h=u[m])>="A"&&h<="Z")&&(f+=u[m].toLowerCase());for(var h,p,v;d.has(f);){if(/\d/g.test(f)){if(f=f.substr(0,f.length-1)+(f[f.length-1]+1),!(f.length>3))continue;f=f.substr(0,3)}else if(f.length<3){f+="2";continue}let m=1,b=f;for(;d.has(b)&&m<8;)p=f,b=(1&(v=m)?p[0].toUpperCase():p[0].toLowerCase())+(2&v?p[1].toUpperCase():p[1].toLowerCase())+(4&v?p[2].toUpperCase():p[2].toLowerCase()),++m;if(m<8)f=b;else{let w=f.charCodeAt(2)+1&127;f=f.substr(0,2)+String.fromCharCode(w)}}return f}(a,s),s.add(l.idPrefix)),/^\$/.test(a)||(i[`$${a}_mutations`]="++rev",l.markedForSync=!0),l.deleted&&(l.deleted=!1)):(l.deleted=!0,l.markedForSync=!1,i[`$${a}_mutations`]=null)}),e.call(this,i,r)}}const jt=new ye(!0),mi=new ye(!0);var bn,Or;jt.pipe(se(e=>e?De(!0):De(!1).pipe(Ia(2e4))),(Or===void 0&&(Or=sr),bn=bn??rf,fe(function(e,t){var n,r=!0;e.subscribe(le(t,function(i){var o=Or(i);!r&&bn(n,o)||(r=!1,n=o,t.next(i))}))}))).subscribe(mi);const Na=typeof document<"u"?Se(document,"visibilitychange"):De({}),Nf=Na.pipe(ve(()=>document.visibilityState==="hidden")),Wf=Na.pipe(ve(()=>document.visibilityState==="visible")),Wa=typeof window<"u"?As(Wf,Se(window,"mousedown"),Se(window,"mousemove"),Se(window,"keydown"),Se(window,"wheel"),Se(window,"touchmove")):De({});typeof document<"u"&&As(De(!0),Nf,Wa).pipe(xe(()=>document.visibilityState==="visible"),Po(e=>{jt.value!==e&&jt.next(e)}),se(e=>e?De(0).pipe(Ia(16e4),Po(()=>jt.next(!1))):De(0))).subscribe(()=>{});class Hf extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}class Vf extends ee{constructor(t,n,r,i,o,s,a,c){super(l=>new qf(t,n,r,i,a,c,l,o,s))}}let zf=0;class qf extends gt{constructor(t,n,r,i,o,s,a,c,l){super(()=>this.teardown()),this.id=++zf,this.reconnecting=!1,console.debug("New WebSocket Connection",this.id,o?"authorized":"unauthorized"),this.databaseUrl=t,this.rev=n,this.realmSetHash=r,this.clientIdentity=i,this.token=o,this.tokenExpiration=s,this.subscriber=a,this.lastUserActivity=new Date,this.messageProducer=c,this.messageProducerSubscription=null,this.webSocketStatus=l,this.connect()}teardown(){console.debug("Teardown WebSocket Connection",this.id),this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null,this.messageProducerSubscription&&(this.messageProducerSubscription.unsubscribe(),this.messageProducerSubscription=null)}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return R(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return void console.debug("WS not reconnecting just yet",{id:this.id,pauseUntil:this.pauseUntil});if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;if(this.tokenExpiration&&this.tokenExpiration<new Date)return void this.subscriber.error(new Hf);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>R(this,void 0,void 0,function*(){if(this.closed)return console.debug("pinger check",this.id,"CLOSED."),void this.teardown();if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{if(console.debug("pinger setTimeout",this.id,this.pinger?"alive":"dead"),this.pinger)return this.closed?(console.debug("pinger setTimeout",this.id,"subscription is closed"),void this.teardown()):void(this.lastServerActivity<new Date(Date.now()-2e4)?(console.debug("pinger: server is inactive"),console.debug("pinger reconnecting"),this.reconnect()):console.debug("pinger: server still active"))},2e4)}catch{console.debug("pinger catch error",this.id,"reconnecting"),this.reconnect()}else console.debug("pinger",this.id,"reconnecting"),this.reconnect()}),3e4);const t=new URL(this.databaseUrl);t.protocol=t.protocol==="http:"?"ws":"wss";const n=new URLSearchParams;if(this.subscriber.closed)return;n.set("v","2"),n.set("rev",this.rev),n.set("realmsHash",this.realmSetHash),n.set("clientId",this.clientIdentity),this.token&&n.set("token",this.token),console.debug("dexie-cloud WebSocket create");const r=this.ws=new WebSocket(`${t}/changes?${n}`);r.onclose=i=>{this.pinger&&(console.debug("dexie-cloud WebSocket onclosed",this.id),this.reconnect())},r.onmessage=i=>{if(this.pinger){console.debug("dexie-cloud WebSocket onmessage",i.data),this.lastServerActivity=new Date;try{const o=Gn.parse(i.data);if(o.type==="error")throw new Error(`Error message from dexie-cloud: ${o.error}`);o.type==="rev"&&(this.rev=o.rev),o.type!=="pong"&&this.subscriber.next(o)}catch(o){this.subscriber.error(o)}}};try{let i=!1;yield new Promise((o,s)=>{r.onopen=a=>{console.debug("dexie-cloud WebSocket onopen"),i=!0,o(null)},r.onerror=a=>{if(i)this.reconnect();else{const c=a.error||new Error("WebSocket Error");this.subscriber.error(c),this.webSocketStatus.next("error"),s(c)}}}),this.messageProducerSubscription=this.messageProducer.subscribe(o=>{var s;this.closed||(o.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),(s=this.ws)===null||s===void 0||s.send(Gn.stringify(o)))})}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}function Yf(e){return R(this,void 0,void 0,function*(){var t;console.error("WebSocket observable: error but revive when user does some active thing...",e),yield(t=3e3,new Promise(n=>setTimeout(n,t))),console.debug("waiting for someone to do something"),yield Wa.pipe(_e(1)).toPromise(),console.debug("someone did something!")})}function Ho(e){var t;return R(this,void 0,void 0,function*(){return!(!(!((t=e.cloud.options)===null||t===void 0)&&t.databaseUrl)||!e.cloud.schema)&&(yield qt(e,e.cloud.options,e.cloud.schema,{justCheckIfNeeded:!0}))})}const gn=Ji(16);function Gf(e,t,n,r,{awaitRemoteJob:i}={}){return R(this,void 0,void 0,function*(){const o=e.table(n);if(yield function s(){return R(this,void 0,void 0,function*(){if(yield e.transaction("rw!",n,()=>R(this,void 0,void 0,function*(){const a=yield o.get(t);return a?a.heartbeat.getTime()<Date.now()-6e4&&(console.warn(`Latest ${t} worker seem to have died.
`,"The dead job started:",a.started,`
`,"Last heart beat was:",a.heartbeat,`
`,"We're now taking over!"),yield o.put({nodeId:gn,started:new Date,heartbeat:new Date},t),!0):(yield o.add({nodeId:gn,started:new Date,heartbeat:new Date},t),!0)})))return!0;if(i)try{return yield ke(Ve(()=>o.get(t))).pipe(function(c,l){var u=xa(c)?{first:c}:typeof c=="number"?{each:c}:c,d=u.first,f=u.each,h=u.with,p=h===void 0?af:h,v=u.scheduler,m=v===void 0?l??ar:v,b=u.meta,w=b===void 0?null:b;if(d==null&&f==null)throw new TypeError("No timeout provided.");return fe(function(y,g){var _,S,k=null,x=0,I=function(E){S=je(g,m,function(){try{_.unsubscribe(),Je(p({meta:w,lastValue:k,seen:x})).subscribe(g)}catch(A){g.error(A)}},E)};_=y.subscribe(le(g,function(E){S?.unsubscribe(),x++,g.next(k=E),f>0&&I(f)},void 0,void 0,function(){S?.closed||S==null||S.unsubscribe(),k=null})),!x&&I(d!=null?typeof d=="number"?d:+d-m.now():f)})}(6e4),ve(c=>!c)).toPromise(),!1}catch(a){if(a.name!=="TimeoutError")throw a;return yield s()}return!1})}()){const s=setInterval(()=>{o.update(t,a=>{a.nodeId===gn&&(a.heartbeat=new Date)})},1e3);try{return yield r()}finally{clearInterval(s),yield e.transaction("rw!",n,()=>R(this,void 0,void 0,function*(){const a=yield o.get(t);a&&a.nodeId===gn&&(yield o.delete(t))}))}}})}const wn=new WeakMap;function Ha(e,t,n,r){const i=wn.get(e);if(i){if(i.pull||r?.purpose==="push")return console.debug("syncIfPossible(): returning the ongoing sync promise."),i.promise;{let s=!1;const a=e.cloud.syncState.subscribe(c=>{c.phase==="pulling"&&(s=!0)});return i.promise.then(()=>{a.unsubscribe()}).catch(c=>(a.unsubscribe(),Promise.reject(c))).then(()=>{if(!s)return Ha(e,t,n,r)})}}const o=function(){return R(this,void 0,void 0,function*(){try{if(e.cloud.isServiceWorkerDB)yield qt(e,t,n,r);else{if(e.cloud.usingServiceWorker)throw sa(!1),new Error("Internal _syncIfPossible() - invalid precondition - should not have been called.");yield Gf(e,"currentSyncWorker","$jobs",()=>qt(e,t,n,r))}wn.delete(e),console.debug("Done sync")}catch(s){throw wn.delete(e),console.error("Failed to sync client changes",s),s}})}();return wn.set(e,{promise:o,pull:r?.purpose!=="push"}),o}function Jf(e,t,n){let r=null,i={cancelled:!1};function o(a,c=1){setTimeout(()=>{Ha(e,t,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:a}).catch(l=>{console.error("error in syncIfPossible()",l),i.cancelled?s():c<3&&setTimeout(()=>o(a,c+1),6e4*[0,5,15][c])})},0)}const s=()=>{console.debug("Stopping LocalSyncWorker"),i.cancelled=!0,r&&r.unsubscribe()};return{start:()=>{console.debug("Starting LocalSyncWorker",e.localSyncEvent.id),r=e.localSyncEvent.subscribe(({purpose:a})=>{try{o(a||"pull")}catch(c){console.error("What-the....",c)}})},stop:s}}function Cr(e,t){if(e&&t&&t.unsyncedTables)for(const n of t.unsyncedTables)e[n]&&(e[n].markedForSync=!1)}var lr,B,Va,Kt,Vo,Jn={},za=[],Xf=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function He(e,t){for(var n in t)e[n]=t[n];return e}function qa(e){var t=e.parentNode;t&&t.removeChild(e)}function ne(e,t,n){var r,i,o,s={};for(o in t)o=="key"?r=t[o]:o=="ref"?i=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?lr.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)s[o]===void 0&&(s[o]=e.defaultProps[o]);return Pn(e,s,r,i,null)}function Pn(e,t,n,r,i){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++Va};return i==null&&B.vnode!=null&&B.vnode(o),o}function rn(e){return e.children}function Bt(e,t){this.props=e,this.context=t}function bt(e,t){if(t==null)return e.__?bt(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?bt(e):null}function Ya(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Ya(e)}}function zo(e){(!e.__d&&(e.__d=!0)&&Kt.push(e)&&!Xn.__r++||Vo!==B.debounceRendering)&&((Vo=B.debounceRendering)||setTimeout)(Xn)}function Xn(){for(var e;Xn.__r=Kt.length;)e=Kt.sort(function(t,n){return t.__v.__b-n.__v.__b}),Kt=[],e.some(function(t){var n,r,i,o,s,a;t.__d&&(s=(o=(n=t).__v).__e,(a=n.__P)&&(r=[],(i=He({},o)).__v=o.__v+1,Xi(a,o,i,n.__n,a.ownerSVGElement!==void 0,o.__h!=null?[s]:null,r,s??bt(o),o.__h),Qa(r,o),o.__e!=s&&Ya(o)))})}function Ga(e,t,n,r,i,o,s,a,c,l){var u,d,f,h,p,v,m,b=r&&r.__k||za,w=b.length;for(n.__k=[],u=0;u<t.length;u++)if((h=n.__k[u]=(h=t[u])==null||typeof h=="boolean"?null:typeof h=="string"||typeof h=="number"||typeof h=="bigint"?Pn(null,h,null,null,h):Array.isArray(h)?Pn(rn,{children:h},null,null,null):h.__b>0?Pn(h.type,h.props,h.key,null,h.__v):h)!=null){if(h.__=n,h.__b=n.__b+1,(f=b[u])===null||f&&h.key==f.key&&h.type===f.type)b[u]=void 0;else for(d=0;d<w;d++){if((f=b[d])&&h.key==f.key&&h.type===f.type){b[d]=void 0;break}f=null}Xi(e,h,f=f||Jn,i,o,s,a,c,l),p=h.__e,(d=h.ref)&&f.ref!=d&&(m||(m=[]),f.ref&&m.push(f.ref,null,h),m.push(d,h.__c||p,h)),p!=null?(v==null&&(v=p),typeof h.type=="function"&&h.__k===f.__k?h.__d=c=Ja(h,c,e):c=Xa(e,h,f,b,p,c),typeof n.type=="function"&&(n.__d=c)):c&&f.__e==c&&c.parentNode!=e&&(c=bt(f))}for(n.__e=v,u=w;u--;)b[u]!=null&&(typeof n.type=="function"&&b[u].__e!=null&&b[u].__e==n.__d&&(n.__d=bt(r,u+1)),eu(b[u],b[u]));if(m)for(u=0;u<m.length;u++)Za(m[u],m[++u],m[++u])}function Ja(e,t,n){for(var r,i=e.__k,o=0;i&&o<i.length;o++)(r=i[o])&&(r.__=e,t=typeof r.type=="function"?Ja(r,t,n):Xa(n,r,r,i,r.__e,t));return t}function Xa(e,t,n,r,i,o){var s,a,c;if(t.__d!==void 0)s=t.__d,t.__d=void 0;else if(n==null||i!=o||i.parentNode==null)e:if(o==null||o.parentNode!==e)e.appendChild(i),s=null;else{for(a=o,c=0;(a=a.nextSibling)&&c<r.length;c+=2)if(a==i)break e;e.insertBefore(i,o),s=o}return s!==void 0?s:i.nextSibling}function qo(e,t,n){t[0]==="-"?e.setProperty(t,n):e[t]=n==null?"":typeof n!="number"||Xf.test(t)?n:n+"px"}function _n(e,t,n,r,i){var o;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||qo(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||qo(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")o=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r||e.addEventListener(t,o?Go:Yo,o):e.removeEventListener(t,o?Go:Yo,o);else if(t!=="dangerouslySetInnerHTML"){if(i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||t[0]==="a"&&t[1]==="r")?e.setAttribute(t,n):e.removeAttribute(t))}}function Yo(e){this.l[e.type+!1](B.event?B.event(e):e)}function Go(e){this.l[e.type+!0](B.event?B.event(e):e)}function Xi(e,t,n,r,i,o,s,a,c){var l,u,d,f,h,p,v,m,b,w,y,g,_,S=t.type;if(t.constructor!==void 0)return null;n.__h!=null&&(c=n.__h,a=t.__e=n.__e,t.__h=null,o=[a]),(l=B.__b)&&l(t);try{e:if(typeof S=="function"){if(m=t.props,b=(l=S.contextType)&&r[l.__c],w=l?b?b.props.value:l.__:r,n.__c?v=(u=t.__c=n.__c).__=u.__E:("prototype"in S&&S.prototype.render?t.__c=u=new S(m,w):(t.__c=u=new Bt(m,w),u.constructor=S,u.render=Zf),b&&b.sub(u),u.props=m,u.state||(u.state={}),u.context=w,u.__n=r,d=u.__d=!0,u.__h=[]),u.__s==null&&(u.__s=u.state),S.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=He({},u.__s)),He(u.__s,S.getDerivedStateFromProps(m,u.__s))),f=u.props,h=u.state,d)S.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(S.getDerivedStateFromProps==null&&m!==f&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(m,w),!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(m,u.__s,w)===!1||t.__v===n.__v){u.props=m,u.state=u.__s,t.__v!==n.__v&&(u.__d=!1),u.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(k){k&&(k.__=t)}),u.__h.length&&s.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(m,u.__s,w),u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(f,h,p)})}if(u.context=w,u.props=m,u.__v=t,u.__P=e,y=B.__r,g=0,"prototype"in S&&S.prototype.render)u.state=u.__s,u.__d=!1,y&&y(t),l=u.render(u.props,u.state,u.context);else do u.__d=!1,y&&y(t),l=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++g<25);u.state=u.__s,u.getChildContext!=null&&(r=He(He({},r),u.getChildContext())),d||u.getSnapshotBeforeUpdate==null||(p=u.getSnapshotBeforeUpdate(f,h)),_=l!=null&&l.type===rn&&l.key==null?l.props.children:l,Ga(e,Array.isArray(_)?_:[_],t,n,r,i,o,s,a,c),u.base=t.__e,t.__h=null,u.__h.length&&s.push(u),v&&(u.__E=u.__=null),u.__e=!1}else o==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Qf(n.__e,t,n,r,i,o,s,c);(l=B.diffed)&&l(t)}catch(k){t.__v=null,(c||o!=null)&&(t.__e=a,t.__h=!!c,o[o.indexOf(a)]=null),B.__e(k,t,n)}}function Qa(e,t){B.__c&&B.__c(t,e),e.some(function(n){try{e=n.__h,n.__h=[],e.some(function(r){r.call(n)})}catch(r){B.__e(r,n.__v)}})}function Qf(e,t,n,r,i,o,s,a){var c,l,u,d=n.props,f=t.props,h=t.type,p=0;if(h==="svg"&&(i=!0),o!=null){for(;p<o.length;p++)if((c=o[p])&&"setAttribute"in c==!!h&&(h?c.localName===h:c.nodeType===3)){e=c,o[p]=null;break}}if(e==null){if(h===null)return document.createTextNode(f);e=i?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,f.is&&f),o=null,a=!1}if(h===null)d===f||a&&e.data===f||(e.data=f);else{if(o=o&&lr.call(e.childNodes),l=(d=n.props||Jn).dangerouslySetInnerHTML,u=f.dangerouslySetInnerHTML,!a){if(o!=null)for(d={},p=0;p<e.attributes.length;p++)d[e.attributes[p].name]=e.attributes[p].value;(u||l)&&(u&&(l&&u.__html==l.__html||u.__html===e.innerHTML)||(e.innerHTML=u&&u.__html||""))}if(function(v,m,b,w,y){var g;for(g in b)g==="children"||g==="key"||g in m||_n(v,g,null,b[g],w);for(g in m)y&&typeof m[g]!="function"||g==="children"||g==="key"||g==="value"||g==="checked"||b[g]===m[g]||_n(v,g,m[g],b[g],w)}(e,f,d,i,a),u)t.__k=[];else if(p=t.props.children,Ga(e,Array.isArray(p)?p:[p],t,n,r,i&&h!=="foreignObject",o,s,o?o[0]:n.__k&&bt(n,0),a),o!=null)for(p=o.length;p--;)o[p]!=null&&qa(o[p]);a||("value"in f&&(p=f.value)!==void 0&&(p!==e.value||h==="progress"&&!p||h==="option"&&p!==d.value)&&_n(e,"value",p,d.value,!1),"checked"in f&&(p=f.checked)!==void 0&&p!==e.checked&&_n(e,"checked",p,d.checked,!1))}return e}function Za(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(r){B.__e(r,n)}}function eu(e,t,n){var r,i;if(B.unmount&&B.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||Za(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){B.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&eu(r[i],t,typeof e.type!="function");n||e.__e==null||qa(e.__e),e.__e=e.__d=void 0}function Zf(e,t,n){return this.constructor(e,n)}function Jo(e,t,n){var r,i,o;B.__&&B.__(e,t),i=(r=typeof n=="function")?null:n&&n.__k||t.__k,o=[],Xi(t,e=(!r&&n||t).__k=ne(rn,null,[e]),i||Jn,Jn,t.ownerSVGElement!==void 0,!r&&n?[n]:i?null:t.firstChild?lr.call(t.childNodes):null,o,!r&&n?n:i?i.__e:t.firstChild,r),Qa(o,e)}lr=za.slice,B={__e:function(e,t,n,r){for(var i,o,s;t=t.__;)if((i=t.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(e)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,r||{}),s=i.__d),s)return i.__E=i}catch(a){e=a}throw e}},Va=0,Bt.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=He({},this.state),typeof e=="function"&&(e=e(He({},n),this.props)),e&&He(n,e),e!=null&&this.__v&&(t&&this.__h.push(t),zo(this))},Bt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),zo(this))},Bt.prototype.render=rn,Kt=[],Xn.__r=0;const we={Error:{color:"red"},Alert:{error:{color:"red"},warning:{color:"yellow"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"30px",marginBottom:"2em",maxWidth:"90%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",width:"auto"},Input:{height:"35px",width:"17em",borderColor:"#ccf4",outline:"none",fontSize:"17pt",padding:"8px"}};function ed({children:e,className:t}){return ne("div",{className:t},ne("div",{style:we.Darken}),ne("div",{style:we.DialogOuter},ne("div",{style:we.DialogInner},e)))}var fr,Q,Tr,Xo,Qn=0,tu=[],Dn=[],Qo=B.__b,Zo=B.__r,es=B.diffed,ts=B.__c,ns=B.unmount;function Qi(e,t){B.__h&&B.__h(Q,e,Qn||t),Qn=0;var n=Q.__H||(Q.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:Dn}),n.__[e]}function td(e){return Qn=1,function(t,n,r){var i=Qi(fr++,2);if(i.t=t,!i.__c&&(i.__=[r?r(n):is(void 0,n),function(s){var a=i.__N?i.__N[0]:i.__[0],c=i.t(a,s);a!==c&&(i.__N=[c,i.__[1]],i.__c.setState({}))}],i.__c=Q,!Q.u)){Q.u=!0;var o=Q.shouldComponentUpdate;Q.shouldComponentUpdate=function(s,a,c){if(!i.__c.__H)return!0;var l=i.__c.__H.__.filter(function(d){return d.__c});if(l.every(function(d){return!d.__N}))return!o||o.call(this,s,a,c);var u=!1;return l.forEach(function(d){if(d.__N){var f=d.__[0];d.__=d.__N,d.__N=void 0,f!==d.__[0]&&(u=!0)}}),!!u&&(!o||o.call(this,s,a,c))}}return i.__N||i.__}(is,e)}function nd(e){return Qn=5,function(t,n){var r=Qi(fr++,7);return nu(r.__H,n)?(r.__V=t(),r.i=n,r.__h=t,r.__V):r.__}(function(){return{current:e}},[])}function rd(){for(var e;e=tu.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Rn),e.__H.__h.forEach(bi),e.__H.__h=[]}catch(t){e.__H.__h=[],B.__e(t,e.__v)}}B.__b=function(e){Q=null,Qo&&Qo(e)},B.__r=function(e){Zo&&Zo(e),fr=0;var t=(Q=e.__c).__H;t&&(Tr===Q?(t.__h=[],Q.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=Dn,n.__N=n.i=void 0})):(t.__h.forEach(Rn),t.__h.forEach(bi),t.__h=[])),Tr=Q},B.diffed=function(e){es&&es(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(tu.push(t)!==1&&Xo===B.requestAnimationFrame||((Xo=B.requestAnimationFrame)||function(n){var r,i=function(){clearTimeout(o),rs&&cancelAnimationFrame(r),setTimeout(n)},o=setTimeout(i,100);rs&&(r=requestAnimationFrame(i))})(rd)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==Dn&&(n.__=n.__V),n.i=void 0,n.__V=Dn})),Tr=Q=null},B.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Rn),n.__h=n.__h.filter(function(r){return!r.__||bi(r)})}catch(r){t.some(function(i){i.__h&&(i.__h=[])}),t=[],B.__e(r,n.__v)}}),ts&&ts(e,t)},B.unmount=function(e){ns&&ns(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{Rn(r)}catch(i){t=i}}),t&&B.__e(t,n.__v))};var rs=typeof requestAnimationFrame=="function";function Rn(e){var t=Q,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),Q=t}function bi(e){var t=Q;e.__c=e.__(),Q=t}function nu(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function is(e,t){return typeof t=="function"?t(e):t}function id({title:e,alerts:t,fields:n,onCancel:r,onSubmit:i}){const[o,s]=td({}),a=nd(null);return function(c,l){var u=Qi(fr++,4);!B.__s&&nu(u.__H,l)&&(u.__=c,u.i=l,Q.__h.push(u))}(()=>{var c;return(c=a.current)===null||c===void 0?void 0:c.focus()},[]),ne(ed,{className:"dxc-login-dlg"},ne(rn,null,ne("h3",{style:we.WindowHeader},e),t.map(c=>ne("p",{style:we.Alert[c.type]},function({message:l,messageCode:u,messageParams:d}){return l.replace(/\{\w+\}/gi,f=>d[f.substr(1,f.length-2)])}(c))),ne("form",{onSubmit:c=>{c.preventDefault(),i(o)}},Object.entries(n).map(([c,{type:l,label:u,placeholder:d}],f)=>ne("label",{style:we.Label},u?`${u}: `:"",ne("input",{ref:f===0?a:void 0,type:l,name:c,autoComplete:"on",style:we.Input,autoFocus:!0,placeholder:d,value:o[c]||"",onInput:h=>{var p;return s(Object.assign(Object.assign({},o),{[c]:od(l,(p=h.target)===null||p===void 0?void 0:p.value)}))}}))))),ne("div",{style:we.ButtonsDiv},ne("button",{type:"submit",style:we.Button,onClick:()=>i(o)},"Submit"),ne("button",{style:we.Button,onClick:r},"Cancel")))}function od(e,t){switch(e){case"email":return t.toLowerCase();case"otp":return t.toUpperCase();default:return t}}class os extends Bt{constructor(t){super(t),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=ke(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(t,{userInteraction:n}){return n?ne(id,Object.assign({},n)):null}}function on(e){const t=new WeakMap;return n=>{let r=t.get(n);return r||(r=e(n),t.set(n,r)),r}}function dr(e,t){let n=t,r=ke(e).pipe(er(o=>n=o),uc({resetOnRefCountZero:()=>ac(1e3)}));const i=new ee(o=>{let s=!1;const a=r.subscribe({next(c){s=!0,o.next(c)},error(c){o.error(c)},complete(){o.complete()}});return s||a.closed||o.next(n),a});return i.getValue=()=>n,i}const ru=on(e=>dr(Ve(()=>e.roles.where({realmId:"rlm-public"}).toArray().then(t=>{const n={};for(const r of t.slice().sort((i,o)=>(i.sortOrder||0)-(o.sortOrder||0)))n[r.name]=r;return n})),{})),Zi=on(e=>new ye(be)),iu=on(e=>dr(Zi(e._novip).pipe(se(t=>Ve(()=>e.transaction("r","realms","members",()=>Promise.all([e.members.where({userId:t.userId}).toArray(),e.realms.toArray(),t.userId]).then(([n,r,i])=>({selfMembers:n,realms:r,userId:i})))))),{selfMembers:[],realms:[],get userId(){return e.cloud.currentUserId}}));function sd(...e){return e.length===0?{}:e.reduce((n,r)=>{const i=Object.assign({},n);for(const[o,s]of Object.entries(r))if(o in i&&i[o]){if(i[o]==="*")continue;if(s==="*")i[o]="*";else if(Array.isArray(s)&&Array.isArray(i[o])){const a=i,c=a[o];a[o]=[...new Set([...c,...s])]}else if(typeof s=="object"&&s&&typeof i[o]=="object"){const a=i[o];for(const[c,l]of Object.entries(s))a[c]!=="*"&&(l==="*"?a[c]="*":Array.isArray(a[c])&&Array.isArray(l)&&(a[c]=[...new Set([...a[c],...l])]))}}else i[o]=r[o];return i})}const ou=on(e=>function(t,n){let r;const i=t.pipe(er(o=>r=n(o)));return i.getValue=()=>r!==void 0?r:r=n(t.getValue()),i}(dr(Bn([iu(e._novip),ru(e._novip)]).pipe(xe(([{selfMembers:t,realms:n,userId:r},i])=>({selfMembers:t,realms:n,userId:r,globalRoles:i}))),{selfMembers:[],realms:[],userId:be.userId,globalRoles:{}}),({selfMembers:t,realms:n,userId:r,globalRoles:i})=>n.map(s=>{const a=t.filter(u=>u.realmId===s.realmId),c=a.map(u=>u.permissions).filter(u=>u),l=Ca(a.map(u=>u.roles).filter(u=>u)).map(u=>i[u]).filter(u=>u).map(u=>u.permissions);return Object.assign(Object.assign({},s),{permissions:s.owner===r?{manage:"*"}:sd(...c,...l)})}).reduce((s,a)=>Object.assign(Object.assign({},s),{[a.realmId]:a}),{[r]:{realmId:r,owner:r,name:r,permissions:{manage:"*"}}})));class ss{constructor(t,n,r){this.permissions=t||{},this.tableName=n,this.isOwner=r}add(...t){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!t.every(r=>{var i;return(i=this.permissions.add)===null||i===void 0?void 0:i.includes(r)})}update(...t){var n,r;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return t.every(o=>o!=="owner");const i=(r=this.permissions.update)===null||r===void 0?void 0:r[this.tableName];return i==="*"?t.every(o=>o!=="owner"):t.every(o=>i?.some(s=>s===o||s==="*"&&o!=="owner"))}delete(){var t;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((t=this.permissions.manage)===null||t===void 0)&&t.includes(this.tableName))}}const ad=on(e=>{const t=Zi(e._novip).pipe(se(i=>Ve(()=>e.members.where({email:i.email||""}).toArray()))),n=ou(e._novip),r=iu(e._novip);return dr(Bn([t,r,n]).pipe(xe(([i,o,s])=>{const a=(u,d)=>Object.assign(Object.assign({},u),{[d.id]:Object.assign(Object.assign({},d),{realm:s[d.realmId]})}),c=i.reduce(a,{}),l=o.selfMembers.reduce(a,c);return Object.values(l).filter(u=>!u.accepted&&!u.rejected).map(u=>Object.assign(Object.assign({},u),{accept(){return R(this,void 0,void 0,function*(){yield e.members.update(u.id,{accepted:new Date})})},reject(){return R(this,void 0,void 0,function*(){yield e.members.update(u.id,{rejected:new Date})})}}))})),[])}),ud={nameSuffix:!0};function gi(e){const t=e.name,n=Zi(e),r=[];let i=!1,o=null;e.on("ready",u=>R(this,void 0,void 0,function*(){try{yield function(d){var f,h,p,v,m,b,w;return R(this,void 0,void 0,function*(){s=!1;const y=Xe(d);typeof window<"u"&&typeof document<"u"&&(!((f=y.cloud.options)===null||f===void 0)&&f.customLoginGui||r.push(function(k){let x=!1;const I=document.createElement("div");return document.body?(document.body.appendChild(I),Jo(ne(os,{db:k.vip}),I)):addEventListener("DOMContentLoaded",()=>{x||(document.body.appendChild(I),Jo(ne(os,{db:k.vip}),I))}),{unsubscribe(){try{I.remove()}catch{}x=!0},get closed(){return x}}}(d))),y.cloud.isServiceWorkerDB||r.push(function(k){let x=k.cloud.webSocketStatus.value;const I=k.cloud.webSocketStatus.pipe(se(E=>{const A=x;x=E;const T=De(E);switch(E){case"disconnected":return jt.value?T.pipe(Co(500)):T;case"connecting":return A==="not-started"||A==="error"?T:T.pipe(Co(4e3));default:return T}}));return Bn([I,k.syncStateChangedEvent.pipe(of({phase:"initial"})),mi]).pipe(xe(([E,A,T])=>{let{phase:O,error:P,progress:D}=A,U=E;return O==="error"&&(U="error"),E==="not-started"&&(O!=="pushing"&&O!=="pulling"||(U="connecting")),k.cloud.syncState.value.phase!=="error"||A.phase!=="pushing"&&A.phase!=="pulling"||(U="connecting"),T||(U="disconnected"),{phase:O,error:P,progress:D,status:nt?U:"offline"}}))}(y).subscribe(d.cloud.syncState)),r.push(y.syncCompleteEvent.subscribe(c)),y.tables.every(k=>k.core)||Fa();const g="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],_=yield y.transaction("rw",y.$syncState,()=>R(this,void 0,void 0,function*(){var k,x;const{options:I,schema:E}=y.cloud,[A,T,O]=yield Promise.all([y.getOptions(),y.getSchema(),y.getPersistedSyncState()]);if(i){if(!A||JSON.stringify(A)!==JSON.stringify(I)){if(!I)throw new Error("Internal error");const P=Object.assign({},I);delete P.fetchTokens,yield y.$syncState.put(P,"options")}}else y.cloud.options=A||null;if(((k=y.cloud.options)===null||k===void 0?void 0:k.tryUseServiceWorker)&&"serviceWorker"in navigator&&g.length>0&&!No?(console.debug("Dexie Cloud Addon: Using service worker"),y.cloud.usingServiceWorker=!0):(((x=y.cloud.options)===null||x===void 0?void 0:x.tryUseServiceWorker)&&!y.cloud.isServiceWorkerDB&&console.debug("dexie-cloud-addon: Not using service worker.",g.length===0?"No SW registrations found.":"serviceWorker"in navigator&&No?"Avoiding SW background sync and SW periodic bg sync for this browser due to browser bugs.":"navigator.serviceWorker not present"),y.cloud.usingServiceWorker=!1),Cr(E,y.cloud.options),Cr(T,y.cloud.options),E){if(!T||JSON.stringify(T)!==JSON.stringify(E)){const P=T||{};for(const[D,U]of Object.entries(E)){const H=P[D];H?(H.markedForSync=U.markedForSync,U.deleted=H.deleted,H.generatedGlobalId=U.generatedGlobalId):P[D]=Object.assign({},U)}yield y.$syncState.put(P,"schema"),Object.assign(E,P)}}else y.cloud.schema=T||null;return O?.initiallySynced}));_&&y.setInitiallySynced(!0),function(k){var x,I;for(const E of k.tables)if(!((I=(x=k.cloud.schema)===null||x===void 0?void 0:x[E.name])===null||I===void 0)&&I.markedForSync){if(E.schema.primKey.auto)throw new q.SchemaError(`Table ${E.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(E.name)}]}) to blacklist it from sync`);if(!E.schema.primKey.keyPath)throw new q.SchemaError(`Table ${E.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(E.name)}]}) to blacklist it from sync`)}}(y),((h=y.cloud.options)===null||h===void 0?void 0:h.databaseUrl)&&!_&&(yield function(k,x,I){return R(this,void 0,void 0,function*(){console.debug("Performing initial sync"),yield qt(k,x,I,{isInitialSync:!0}),console.debug("Done initial sync")})}(y,y.cloud.options,y.cloud.schema),y.setInitiallySynced(!0)),a(),y.cloud.isServiceWorkerDB||(r.push(Ve(()=>y.getCurrentUser()).subscribe(n)),r.push(Ve(()=>y.getPersistedSyncState()).subscribe(y.cloud.persistedSyncState)),yield Bn([n.pipe(To(1),_e(1)),y.cloud.persistedSyncState.pipe(To(1),_e(1))]).toPromise());let S=!1;!((p=y.cloud.options)===null||p===void 0)&&p.requireAuth&&(S=yield Bo(y)),o&&o.stop(),o=null,a(),y.cloud.usingServiceWorker&&((v=y.cloud.options)===null||v===void 0?void 0:v.databaseUrl)?(qi(y,S?"pull":"push").catch(()=>{}),function(k){var x;return R(this,void 0,void 0,function*(){try{const{periodicSync:I}=yield navigator.serviceWorker.ready;if(I)try{yield I.register(`dexie-cloud:${k.name}`,(x=k.cloud.options)===null||x===void 0?void 0:x.periodicSync),console.debug(`Dexie Cloud: Successfully registered periodicsync event for ${k.name}`)}catch(E){console.debug("Dexie Cloud: Failed to register periodic sync. Your PWA must be installed to allow background sync.",E)}else console.debug("Dexie Cloud: periodicSync not supported.")}catch(I){console.debug(`Dexie Cloud: Could not register periodicSync for ${k.name}`,I)}})}(y).catch(()=>{})):((m=y.cloud.options)===null||m===void 0?void 0:m.databaseUrl)&&y.cloud.schema&&!y.cloud.isServiceWorkerDB&&(o=Jf(y,y.cloud.options,y.cloud.schema),o.start(),We(y,S?"pull":"push")),a(),y.cloud.isServiceWorkerDB||r.push(Se(self,"online").subscribe(()=>{console.debug("online!"),y.syncStateChangedEvent.next({phase:"not-in-sync"}),We(y,"push")}),Se(self,"offline").subscribe(()=>{console.debug("offline!"),y.syncStateChangedEvent.next({phase:"offline"})})),!(!((b=y.cloud.options)===null||b===void 0)&&b.databaseUrl)||((w=y.cloud.options)===null||w===void 0?void 0:w.disableWebSocket)||jf||r.push(function(k){var x;if(!(!((x=k.cloud.options)===null||x===void 0)&&x.databaseUrl))throw new Error("No database URL to connect WebSocket to");const I=k.messageConsumer.readyToServe.pipe(ve(E=>E),se(()=>k.getPersistedSyncState()),ve(E=>E&&E.serverRevision),se(E=>R(this,void 0,void 0,function*(){return{type:"ready",rev:E.serverRevision,realmSetHash:yield hi(E)}})));return function E(){return k.cloud.persistedSyncState.pipe(ve(A=>A?.serverRevision),_e(1),se(A=>k.cloud.currentUser.pipe(xe(T=>[T,A]))),se(([A,T])=>mi.pipe(xe(O=>[O?A:null,T]))),se(([A,T])=>A?.isLoggedIn&&!T?.realms.includes(A.userId)?k.cloud.persistedSyncState.pipe(ve(O=>O?.realms.includes(A.userId)||!1),_e(1),xe(O=>[A,O])):new ye([A,T])),se(([A,T])=>R(this,void 0,void 0,function*(){return[A,yield hi(T)]})),se(([A,T])=>A?new Vf(k.cloud.options.databaseUrl,k.cloud.persistedSyncState.value.serverRevision,T,k.cloud.persistedSyncState.value.clientIdentity,I,k.cloud.webSocketStatus,A.accessToken,A.accessTokenExpiration):ke([])),ui(A=>A?.name==="TokenExpiredError"?(console.debug("WebSocket observable: Token expired. Refreshing token..."),De(!0).pipe(se(()=>R(this,void 0,void 0,function*(){const T=yield k.getCurrentUser(),O=yield cr(k.cloud.options.databaseUrl,T);yield k.table("$logins").update(T.userId,{accessToken:O.accessToken,accessTokenExpiration:O.accessTokenExpiration})})),se(()=>E()))):$u(A)),ui(A=>(k.cloud.webSocketStatus.next("error"),ke(Yf(A)).pipe(se(()=>E())))))}().subscribe(E=>{E&&(console.debug("WS got message",E),k.messageConsumer.enqueue(E))},E=>{console.error("Oops! The main observable errored!",E)},()=>{console.error("Oops! The main observable completed!")})}(y))})}(u)}catch(d){console.error(d)}}),!0);let s=!1;function a(){if(s)throw new q.DatabaseClosedError}(function(u,d){u.on.close.subscribe(d);const f=u.close;u.close=function(){f.call(this),d()}})(e,()=>{r.forEach(u=>u.unsubscribe()),s=!0,o&&o.stop(),o=null,n.next(be)});const c=new Gt;var l;e.cloud={version:"4.0.1-beta.40",options:Object.assign({},ud),schema:null,get currentUserId(){return n.value.userId||be.userId},currentUser:n,syncState:new ye({phase:"initial",status:"not-started"}),events:{syncComplete:c},persistedSyncState:new ye(void 0),userInteraction:new ye(void 0),webSocketStatus:new ye("not-started"),login(u){return R(this,void 0,void 0,function*(){const d=Xe(e);yield d.cloud.sync(),yield Bo(d,u)})},invites:ad(e),roles:ru(e),configure(u){u=e.cloud.options=Object.assign(Object.assign({},e.cloud.options),u),i=!0,u.databaseUrl&&u.nameSuffix&&(e.name=`${t}-${function(d){const f=new URL(d);return f.pathname==="/"?f.hostname.split(".")[0]:f.pathname.split("/")[1]}(u.databaseUrl)}`,Xe(e).reconfigure()),Cr(e.cloud.schema,e.cloud.options)},sync({wait:u,purpose:d}={wait:!0,purpose:"push"}){return R(this,void 0,void 0,function*(){u===void 0&&(u=!0);const f=Xe(e);if(d==="pull"){const h=f.cloud.persistedSyncState.value;if(We(f,d),u){const p=yield f.cloud.persistedSyncState.pipe(ve(v=>v?.timestamp!=null&&(!h||v.timestamp>h.timestamp)),_e(1)).toPromise();if(p?.error)throw new Error("Sync error: "+p.error)}}else if(yield Ho(f)){const h=f.cloud.persistedSyncState.value;We(f,d),u&&(console.debug("db.cloud.login() is waiting for sync completion..."),yield ke(Ve(()=>R(this,void 0,void 0,function*(){const p=yield Ho(f),v=yield f.getPersistedSyncState();if(v?.timestamp!==h?.timestamp&&v?.error)throw new Error("Sync error: "+v.error);return p}))).pipe(ve(p=>!p),_e(1)).toPromise(),console.debug("Done waiting for sync completion because we have nothing to push anymore"))}})},permissions:(u,d)=>function(f,h,p){if(!h)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:v,realmId:m}=h;if(!p){if(typeof h.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");p=h.table()}const b=ou(f),w=g=>{const _=g[m||f.cloud.currentUserId];return _?new ss(_.permissions,p,m===f.cloud.currentUserId||v===f.cloud.currentUserId):new ss({},p,!v||v===f.cloud.currentUserId)},y=b.pipe(xe(w));return y.getValue=()=>w(b.getValue()),y}(e._novip,u,d)},e.Version.prototype._parseStoresSpec=q.override(e.Version.prototype._parseStoresSpec,u=>$f(u,e)),e.Table.prototype.newId=function({colocateWith:u}={}){const d=u&&u.substr(u.length-3);return $a(e.cloud.schema[this.name].idPrefix||"",d)},e.Table.prototype.idPrefix=function(){var u,d;return((d=(u=this.db.cloud.schema)===null||u===void 0?void 0:u[this.name])===null||d===void 0?void 0:d.idPrefix)||""},e.use(Ff({currentUserObservable:e.cloud.currentUser,db:Xe(e)})),e.use((l=Xe(e),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:u=>Object.assign(Object.assign({},u),{table:d=>{const f=u.table(d);return Object.assign(Object.assign({},f),{mutate:h=>{var p,v,m,b;if(h.trans.disableChangeTracking)return f.mutate(h);const w=h.trans;if(((v=(p=l.cloud.schema)===null||p===void 0?void 0:p[d])===null||v===void 0?void 0:v.markedForSync)&&(h.type==="add"||h.type==="put"))for(const y of h.values){y.owner||(y.owner=w.currentUser.userId),y.realmId||(y.realmId=w.currentUser.userId);const g=(b=(m=f.schema.primaryKey).extractKey)===null||b===void 0?void 0:b.call(m,y);typeof g=="string"&&g[0]==="#"&&h.type==="put"&&(delete h.criteria,delete h.changeSpec,delete h.updates,y.$ts=Date.now())}return f.mutate(h)}})}})})),e.use(Mf(Xe(e)))}gi.version="4.0.1-beta.40",q.Cloud=gi;var Ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dd(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function hd(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),t}function pd(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var su={exports:{}};(function(e,t){(function(n,r){r()})(Ot,function(){function n(l,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,u,d){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){c(f.response,u,d)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var u=new XMLHttpRequest;u.open("HEAD",l,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function o(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Ot=="object"&&Ot.global===Ot?Ot:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,u,d){var f=s.URL||s.webkitURL,h=document.createElement("a");u=u||l.name||"download",h.download=u,h.rel="noopener",typeof l=="string"?(h.href=l,h.origin===location.origin?o(h):i(h.href)?r(l,u,d):o(h,h.target="_blank")):(h.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(h.href)},4e4),setTimeout(function(){o(h)},0))}:"msSaveOrOpenBlob"in navigator?function(l,u,d){if(u=u||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(n(l,d),u);else if(i(l))r(l,u,d);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){o(f)})}}:function(l,u,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return r(l,u,d);var h=l.type==="application/octet-stream",p=/constructor/i.test(s.HTMLElement)||s.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||h&&p||a)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var y=m.result;y=v?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=y:location=y,f=null},m.readAsDataURL(l)}else{var b=s.URL||s.webkitURL,w=b.createObjectURL(l);f?f.location=w:location.href=w,f=null,setTimeout(function(){b.revokeObjectURL(w)},4e4)}});s.saveAs=c.saveAs=c,e.exports=c})})(su);var cd=su.exports,ct="Welcome! I'm ModelPrompter, a friendly chatbot here to help. Ask me anything!";class ld{constructor(){this.setup()}async setup(){this.db=await new q("chat",{addons:[gi]}),Sn.realms="@realmId",Sn.members="@id,realmId,email",Sn.roles="[realmId+name]",await fd.db.version(23).stores(Sn),await this.db.cloud.configure({databaseUrl:"https://zy3ba3s2n.dexie.cloud",customLoginGui:!0,requireAuth:!1}),(await this.db.channels.toArray()).length||await this.createChannel({id:"chnSystem",name:"System",prompt:ct,chatModeDisabled:!1})}async updateSorts(t){for(const n of t)await this.db.channels.update(n.id,{id:n.id,name:n.name,sort:n.sort})}error(t){console.error(t)}async getMessagesWithSystemPrompt(t="chnSystem"){let n=[];if(n=await this.db.messages.where("channel").equals(t).toArray().catch(this.error),!t&&!n.length)n=[await this.createMessage()];else if(!n.length){const r=await this.db.channels.get(t);r?.prompt?n=[await this.createMessage({channel:t,text:r.prompt})]:n=[await this.createMessage()]}return n}async getChannels(){const t=await this.db.channels.toArray();return t.sort((r,i)=>r.sort<i.sort?-1:r.sort>i.sort?1:0),await this.db.channels.get("chnSystem")||await this.createChannel({id:"chnSystem",name:"System",prompt:ct,chatModeDisabled:!1}),t}async createMessage(t={}){t.name=t.name||"System",t.channel=t.channel||"chnSystem",t.created=t.date||new Date,t.updated=t.updated||new Date,t.text=t.text||ct,t.sent=t.sent||!1;const n=await this.db.messages.add(t).catch(this.error);return await this.db.messages.get(n).catch(this.error)}async updateMessage(t,n={},r=!1){return r||(n.updated=n.updated||new Date),await this.db.messages.update(t,n),await this.db.messages.get(t)}async createChannel(t={}){t.name=t.name||"Untitled",t.prompt=t.prompt||ct,t.created=t.created||new Date,t.updated=t.updated||new Date,t.chatModeDisabled=!1;const n=await this.db.channels.add(t).catch(this.error);return await this.db.channels.get(n).catch(this.error)}async updateChannel(t={}){return t.name=t.name||"Untitled",t.prompt=t.prompt||ct,t.updated=t.updated||new Date,t.realmId=t.realmId||(this.db?.cloud?.currentUserId==="unauthorized"?null:this.db?.cloud?.currentUserId),await this.db.channels.update(t.id,t).catch(this.error),await this.db.channels.get(t.id).catch(this.error)}async deleteChannel(t){await this.db.channels.delete(t).catch(this.error)}async getSettings(){const t=await this.db.settings.toArray().catch(this.error),n={};return t.forEach(r=>{n[r.key]=r.value}),n}async updateSettings(t={}){for(const n in t){const r=await this.db.settings.get({key:n});r?await this.db.settings.update(r.id,{value:t[n]}).catch(this.error):await this.db.settings.add({key:n,value:t[n]}).catch(this.error)}}async exportDatabase(){const t={settings:await this.db.settings.toArray().catch(this.error),channels:await this.db.channels.toArray().catch(this.error),messages:await this.db.messages.toArray().catch(this.error)},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=new File([n],"prompter.json",{type:"application/json"}),i=new Date().toISOString().split("T");cd.saveAs(r,`${i[0]}.prompter.json`)}async importDatabase(t,n){const r=JSON.parse(await t.text());await this.db.settings.toArray(),await this.db.settings.bulkPut(r.settings).catch(this.error);for(const i of r.channels)await this.db.channels.get(i.id)?await this.db.channels.update(i.id,i).catch(this.error):await this.db.channels.add(i).catch(this.error);for(const i of r.messages)await this.db.messages.get(i.id)?await this.db.messages.update(i.id,i).catch(this.error):await this.db.messages.add(i).catch(this.error);this.db.cloud.sync()}async deleteDatabase(){const t=await this.db.messages.toArray();for(const i of t)await this.db.messages.delete(i.id).catch(this.error);const n=await this.db.channels.toArray();for(const i of n)await this.db.channels.delete(i.id).catch(this.error);const r=await this.db.settings.toArray();for(const i of r)await this.db.settings.delete(i.id).catch(this.error);await this.createChannel({id:"chnSystem",name:"System",prompt:ct,chatModeDisabled:!1}),this.db.cloud.sync()}async isLoggedIn(){return this.db.cloud.currentUserId!="unauthorized"}async publishChannel(t){this.db.channels.update(t,{realmId:"rlm-public"});const n=await this.db.messages.where("channel").equals(t).toArray();for(const r of n)this.db.messages.update(r.id,{realmId:"rlm-public"});return await this.db.channels.get(t)}async unpublishChannel(t){return this.db.channels.update(t,{realmId:this.db.cloud.currentUserId}),await this.db.channels.get(t)}}const fd=new ld,Sn={channels:"@id, sort, realmId, name, publishedFrom, publishedTo, updated",messages:"@id, sort, realmId, channel, timestamp, from, to",settings:"@id, realmId, key, value"};export{ct as S,dd as a,pd as b,Ot as c,hd as g,Ve as l,fd as s};
